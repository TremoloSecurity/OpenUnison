<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>Tremolo Security OpenUnison Configuration &amp; Deployment</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


/*
 * Theme specific overrides of the preceding (asciidoc.css) CSS.
 *
 */
body {
  font-family: Garamond, Georgia, serif;
  font-size: 17px;
  color: #3E4349;
  line-height: 1.3em;
}
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Garmond, Georgia, serif;
  font-weight: normal;
  border-bottom-width: 0;
  color: #3E4349;
}
div.title, caption.title { color: #596673; font-weight: bold; }
h1 { font-size: 240%; }
h2 { font-size: 180%; }
h3 { font-size: 150%; }
h4 { font-size: 130%; }
h5 { font-size: 115%; }
h6 { font-size: 100%; }
#header h1 { margin-top: 0; }
#toc {
  color: #444444;
  line-height: 1.5;
  padding-top: 1.5em;
}
#toctitle {
  font-size: 20px;
}
#toc a {
    border-bottom: 1px dotted #999999;
    color: #444444 !important;
    text-decoration: none !important;
}
#toc a:hover {
    border-bottom: 1px solid #6D4100;
    color: #6D4100 !important;
    text-decoration: none !important;
}
div.toclevel1 { margin-top: 0.2em; font-size: 16px; }
div.toclevel2 { margin-top: 0.15em; font-size: 14px; }
em, dt, td.hdlist1 { color: black; }
strong { color: #3E4349; }
a { color: #004B6B; text-decoration: none; border-bottom: 1px dotted #004B6B; }
a:visited { color: #615FA0; border-bottom: 1px dotted #615FA0; }
a:hover { color: #6D4100; border-bottom: 1px solid #6D4100; }
div.tableblock > table, table.tableblock { border: 3px solid #E8E8E8; }
th.tableblock, td.tableblock { border: 1px solid #E8E8E8; }
ul > li > * { color: #3E4349; }
pre, tt, .monospaced { font-family: Consolas,Menlo,'Deja Vu Sans Mono','Bitstream Vera Sans Mono',monospace; }
tt, .monospaced { font-size: 0.9em; color: black;
}
div.exampleblock > div.content, div.sidebarblock > div.content, div.listingblock > div.content { border-width: 0 0 0 3px; border-color: #E8E8E8; }
div.verseblock { border-left-width: 0; margin-left: 3em; }
div.quoteblock { border-left-width: 3px; margin-left: 0; margin-right: 0;}
div.admonitionblock td.content { border-left: 3px solid #E8E8E8; }


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Tremolo Security OpenUnison Configuration &amp; Deployment</h1>
<span id="author">Tremolo Security, Inc</span><br>
<span id="revnumber">version 1.0.6,</span>
<span id="revdate">2015-06-20</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Copyright 2015, Tremolo Security, Inc.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph"><p>OpenUnison combines identity services that are most used by applications into
a single system:</p></div>
<div class="ulist"><ul>
<li>
<p>
Authentication
</p>
</li>
<li>
<p>
Session Management
</p>
</li>
<li>
<p>
Identity Federation
</p>
</li>
<li>
<p>
User Provisioning
</p>
</li>
<li>
<p>
Access Request Management
</p>
</li>
</ul></div>
<div class="paragraph"><p>These services are provided by a J2EE application that can be deployed into
any servlet container.</p></div>
<div class="sect2">
<h3 id="_web_access_manager">Web Access Manager</h3>
<div class="paragraph"><p>When deployed for web access management, OpenUnison is a reverse proxy, sitting
between your users and your web applications.</p></div>
<div class="paragraph"><p><span class="image">
<img src="images/unison-manual-rev-proxy.png" alt="OpenUnison Reverse Proxy">
</span></p></div>
<div class="paragraph"><p>When a user attempts to access your web application, they&#8217;ll always go through
OpenUnison:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
User requests your application
</p>
</li>
<li>
<p>
OpenUnison checks to see if the URL is protected
</p>
</li>
<li>
<p>
If the URL is protected, OpenUnison will check to see if your are authenticated
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
If you are authenticated, check if authentication level is valid
</p>
</li>
<li>
<p>
If you aren&#8217;t authenticated, or your authentication level isn&#8217;t valid execute the authentication chain
</p>
</li>
</ol></div>
</li>
<li>
<p>
OpenUnison checks if you are authorized
</p>
</li>
<li>
<p>
If authorized, OpenUnison can execute a series of filters to manipulate the request or response
</p>
</li>
<li>
<p>
OpenUnison generates a Last Mile token that contains the user&#8217;s attributes, nonce, time range and the request URI
</p>
</li>
<li>
<p>
The request is sent your application
</p>
</li>
<li>
<p>
The application, deployed with a Last Mile component, validates the Last Mile token and sets the user&#8217;s context
</p>
</li>
</ol></div>
<div class="paragraph"><p>The reverse proxy model offers several advantages over a typical agent model:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Performance - Agents need to "phone home" to verify access
</p>
</li>
<li>
<p>
Ease of development - Develoeprs can write applications "in a vacuum" and integrate later
</p>
</li>
<li>
<p>
Ease of deployment - Last Mile components are lighter then typical agents
</p>
</li>
<li>
<p>
Just-In-Time Provisioning - Create accounts in applications before they login
</p>
</li>
</ol></div>
</div>
<div class="sect2">
<h3 id="_user_provisioning_system">User Provisioning System</h3>
<div class="paragraph"><p>In addition to web access management, OpenUnison provides a user provisioning system that can be used to build a private IDentity as a Service solution.  The APIs
provided by OpenUnison can be used directly by applications or in conjunction with Tremolo Security Scale to provide an interface for user registration, requesting access
to resources and approving access via workflows.  The data is recorded in an audit database that allows for reporting on who requested access to what and who approved the access.</p></div>
<div class="paragraph"><p><span class="image">
<img src="images/scale_architecture.png" alt="Scale and OpenUnison Architecture">
</span></p></div>
</div>
<div class="sect2">
<h3 id="_ldap_virtual_directory">LDAP Virtual Directory</h3>
<div class="paragraph"><p>OpenUnison integrates MyVirtualDirectory as an internal LDAP Virtual Directory.  The provisioning services provide a limited search capability, but there&#8217;s no LDAP interface provided.
The configurations used to power the embedded MyVirtualDirectory can be used in a stand alone MyVirtualDirectory server.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deploying_openunison">Deploying OpenUnison</h2>
<div class="sectionbody">
<div class="paragraph"><p>OpenUnison is packaged as a Maven web application that can be customized using Maven&#8217;s overlay plugin.  This makes integration into any DevOps platform very easy, as out of the box
there are only 3 files that need to be created:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
unison.xml - The main OpenUnison configuration file
</p>
</li>
<li>
<p>
unisonKeyStore.jks - The key store for OpenUnison
</p>
</li>
<li>
<p>
myvd.conf - The MyVirtualDirectory configuration file
</p>
</li>
</ol></div>
<div class="paragraph"><p>The is section details how to create these files and deploy them, but not their individual configurations.  The Configuration Reference section details how to configure OpenUnison.</p></div>
<div class="sect2">
<h3 id="_deploy_reverse_proxy">Deploy Reverse Proxy</h3>
<div class="sect3">
<h4 id="_create_a_maven_project">Create a Maven Project</h4>
<div class="paragraph"><p>As stated above, OpenUnison is most easily deployed using a Maven project.  The first step is to create a simple web application project:</p></div>
<div class="listingblock">
<div class="title">Create Simple Maven Project</div>
<div class="content monospaced">
<pre>$ mvn archetype:generate -DgroupId=com.mycompany.openunison -DartifactId=openunison -DinteractiveMode=false -DarchetypeArtifactId=maven-archetype-webapp
$ rm openunison/src/main/webapp/index.jsp
$ rm openunison/src/main/webapp/WEB-INF/web.xml</pre>
</div></div>
<div class="paragraph"><p>Once the project is created, add the Tremolo Security repository, dependencies and overlay plugin:</p></div>
<div class="listingblock">
<div class="title">Tremolo Security Repository</div>
<div class="content monospaced">
<pre>&lt;repositories&gt;
        &lt;repository&gt;
                &lt;id&gt;Tremolo Security&lt;/id&gt;
                &lt;url&gt;https://www.tremolosecurity.com/nexus/content/repositories/releases/&lt;/url&gt;
        &lt;/repository&gt;
&lt;/repositories&gt;</pre>
</div></div>
<div class="listingblock">
<div class="title">OpenUnison Dependencies</div>
<div class="content monospaced">
<pre>&lt;dependencies&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;com.tremolosecurity.unison&lt;/groupId&gt;
  &lt;artifactId&gt;open-unison-webapp&lt;/artifactId&gt;
  &lt;version&gt;1.0.6&lt;/version&gt;
  &lt;type&gt;war&lt;/type&gt;
  &lt;scope&gt;runtime&lt;/scope&gt;

 &lt;/dependency&gt;
 &lt;dependency&gt;
  &lt;groupId&gt;com.tremolosecurity.unison&lt;/groupId&gt;
  &lt;artifactId&gt;open-unison-webapp&lt;/artifactId&gt;
  &lt;version&gt;1.0.6&lt;/version&gt;
  &lt;type&gt;pom&lt;/type&gt;
 &lt;/dependency&gt;
&lt;/dependencies&gt;</pre>
</div></div>
<div class="listingblock">
<div class="title">OpenUnison Overlay Plugin</div>
<div class="content monospaced">
<pre>&lt;build&gt;
 &lt;plugins&gt;
  &lt;plugin&gt;
   &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
   &lt;version&gt;3.1&lt;/version&gt;
   &lt;configuration&gt;
    &lt;source&gt;1.7&lt;/source&gt;
    &lt;target&gt;1.7&lt;/target&gt;
   &lt;/configuration&gt;
  &lt;/plugin&gt;
  &lt;plugin&gt;
   &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
   &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
   &lt;version&gt;2.6&lt;/version&gt;
   &lt;configuration&gt;

    &lt;overlays&gt;
     &lt;overlay&gt;
      &lt;groupId&gt;com.tremolosecurity.unison&lt;/groupId&gt;
      &lt;artifactId&gt;open-unison-webapp&lt;/artifactId&gt;
     &lt;/overlay&gt;
    &lt;/overlays&gt;
   &lt;/configuration&gt;
  &lt;/plugin&gt;
 &lt;/plugins&gt;
&lt;/build&gt;</pre>
</div></div>
<div class="paragraph"><p>If everything is configured correctly, when your run the package artifact with Maven the target directory will contain a war file that contains the OpenUnison files including JSPs and
libraries.</p></div>
</div>
<div class="sect3">
<h4 id="_create_the_key_store">Create the Key Store</h4>
<div class="paragraph"><p>All certificates and keys are stored in a key store called unisonKeyStore.jks.  They key store MUST:</p></div>
<div class="ulist"><ul>
<li>
<p>
Be a Java Extended Key Store (JCEKS)
</p>
</li>
<li>
<p>
All key passwords must match the key store password
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ keytool -genseckey -alias session-unison -keyalg AES -keysize 256 -storetype JCEKS -keystore src/main/webapp/WEB-INF/unisonKeyStore.jks
Enter keystore password:
Re-enter new password:
Enter key password for &lt;session-unison&gt;
 (RETURN if same as keystore password):</pre>
</div></div>
<div class="paragraph"><p>This command created a secret key, a static AES256 key.  This generates the key store as well.  The key that we generated will be used for the session we create.</p></div>
</div>
<div class="sect3">
<h4 id="_virtual_directory_configuration">Virtual Directory Configuration</h4>
<div class="paragraph"><p>OpenUnison uses an embedded version of MyVirtualDirectory to work with user data.  This allows OpenUnison
to work with LDAP directories, databases, Active Directory, web services, etc.  It also provides a powerful mechanism for manipulating identity data.  For instance you
can add attributes to an Active Directory forest without changing the schema.  There are two roots that should be used:</p></div>
<div class="ulist"><ul>
<li>
<p>
ou=Tremolo - This is where OpenUnison will look for identity data
</p>
</li>
<li>
<p>
ou=Data - This is where directories may be configured that OpenUnison won&#8217;t look for identity data
</p>
</li>
</ul></div>
<div class="paragraph"><p>The ou=Data root is useful for configuring joins where the directories being joined are configured under ou=Data and the joiner is configured under ou=Tremolo.  Create a text file called
src/main/webapp/WEB-INF/myvd.conf/myvd.props with the following content:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>#Global AuthMechConfig
server.globalChain=

server.nameSpaces=rootdse,myvdroot
server.rootdse.chain=dse
server.rootdse.nameSpace=
server.rootdse.weight=0
server.rootdse.dse.className=net.sourceforge.myvd.inserts.RootDSE
server.rootdse.dse.config.namingContexts=o=Tremolo
server.myvdroot.chain=root
server.myvdroot.nameSpace=o=Tremolo
server.myvdroot.weight=0
server.myvdroot.root.className=net.sourceforge.myvd.inserts.RootObject</pre>
</div></div>
<div class="paragraph"><p>See MyVirtualDirectory&#8217;s website (<a href="http://myvd.sourceforge.net/">http://myvd.sourceforge.net/</a>) for information on how to configure MyVirtualDirectory.</p></div>
</div>
<div class="sect3">
<h4 id="_create_the_openunison_xml_file">Create the OpenUnison XML File</h4>
<div class="paragraph"><p>OpenUnison&#8217;s unison.xml file drives most of the configuration options.  This file is based on an annotated XML Schema file.  While not required, its recommended that the schema file
be used when creating the unison.xml file.  If using an editor such as Eclipse the schema file will make it much easier to navigate the configuration options.  The easiest way to get this file
is to copy it from the build i</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ cp target/war/work/com.tremolosecurity.unison/open-unison-webapp/WEB-INF/tremoloConfig.xsd src/main/webapp/WEB-INF/</pre>
</div></div>
<div class="paragraph"><p>Once the file is copied, you can create src/main/webapp/WEB-INF/unison.xml file from the schema file.  At a minimum you must set the myvdConfig, keyStorePath and keyStorePassword elements:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;tremoloConfig xmlns="http://www.tremolosecurity.com/tremoloConfig" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.tremolosecurity.com/tremoloConfig tremoloConfig.xsd "&gt;
  &lt;applications/&gt;
  &lt;myvdConfig&gt;WEB-INF/myvd.conf&lt;/myvdConfig&gt;
  &lt;authMechs/&gt;
  &lt;authChains/&gt;
  &lt;resultGroups/&gt;
  &lt;keyStorePath&gt;WEB-INF/unisonKeyStore.jks&lt;/keyStorePath&gt;
  &lt;keyStorePassword&gt;password&lt;/keyStorePassword&gt;
&lt;/tremoloConfig&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_port_configurations">Port Configurations</h4>
<div class="paragraph"><p>OpenUnison can translate between internal and external ports.  An internal port is usually going to be 8080 and 8443 since Tomcat
doesn&#8217;t generally run on a privileged port.  An external port is usually 80 and 443.  This is useful if you are using iptables rules
for port forwarding or a load balancer.  Finally, you can tell OpenUnison to redirect all unsecure requests to a secure port.  Create
a file called src/main/webapp/WEB-INF/unisonService.props.</p></div>
<div class="listingblock">
<div class="title">Example unisonService.props</div>
<div class="content monospaced">
<pre>com.tremolosecurity.openunison.forceToSSL=true
com.tremolosecurity.openunison.openPort=8080
com.tremolosecurity.openunison.securePort=8443
com.tremolosecurity.openunison.externalOpenPort=80
com.tremolosecurity.openunison.externalSecurePort=443
#Uncomment and set for production deployments
#com.tremolosecurity.openunison.activemqdir=/var/lib/unison-activemw</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_create_context_parameters">Create Context Parameters</h4>
<div class="paragraph"><p>The next step is to tell OpenUnison where to find the configuration files.  For Tomcat, this is added to META-INF/context.xml:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;Context&gt;
  &lt;Environment name="unisonConfigPath" value="WEB-INF/unison.xml" type="java.lang.String"/&gt;
  &lt;Environment name="unisonLog4jPath" value="WEB-INF/log4j.xml" type="java.lang.String"/&gt;
  &lt;Environment name="unisonServiceConfigPath" value="WEB-INF/unisonService.props" type="java.lang.String"/&gt;
&lt;/Context&gt;</pre>
</div></div>
<div class="paragraph"><p>At this point, OpenUnison has a minimum configuration for deployment.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_deploying_outside_of_the_war">Deploying Outside of the WAR</h3>
<div class="paragraph"><p>OpenUnison configuration doesn&#8217;t need to be performed inside of the war.  Its just one of the most convinient ways to get started.  All of the above configuraiton options can be specified outside of war by using the full path to the files.  For instance if the unison.xml file will be stored in /etc/unison then set unisonConfigPath to /etc/unison/unison.xml.</p></div>
</div>
<div class="sect2">
<h3 id="_deploy_web_services">Deploy Web Services</h3>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_openunison">Configuring OpenUnison</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_reverse_proxy">Reverse Proxy</h3>
<div class="paragraph"><p>OpenUnison&#8217;s reverse proxy capability is configured around applications and URLs.  An application is a logical collection of URLs.  Each URL is made up of a sequence of hosts, a collection
of filters and potential authorization rules.</p></div>
<div class="paragraph"><p>Before configuring an application you should know:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Whats the URL of the application going to be?
</p>
</li>
<li>
<p>
What host and port will the application be sitting behind the reverse proxy?
</p>
</li>
<li>
<p>
Do you want SSO with other applications?
</p>
</li>
<li>
<p>
How will your users authenticate?
</p>
</li>
<li>
<p>
How will OpenUnison tell your application who&#8217;s logged in?
</p>
</li>
</ol></div>
<div class="paragraph"><p>Once you have the answers to these questions you can begin configuring OpenUnison.</p></div>
</div>
<div class="sect2">
<h3 id="_authentication_mechanisms_authmechs">Authentication Mechanisms (authMechs)</h3>
<div class="paragraph"><p>Authentication Mechanisms define the ways in which a user can be authenticated.
Prior to being added to an authentication chain, a mechanism must
be defined in the section. Every
authentication method has its own configuration parameters. See the
Authentication Mechanisms section of the Configuration Reference for configuration options on
specific mechanisms.  Here&#8217;s an example of the form login mechanism:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--The name attribute is what is referenced in the authentication chain --&gt;
&lt;mechanism name="loginForm"&gt;
 &lt;!-- The URI is where the user is sent when its time to authenticate with this mechanism, MUST start with /auth --&gt;
 &lt;uri&gt;/auth/formLogin&lt;/uri&gt;

 &lt;!-- The class name of the authentication mechanism --&gt;
 &lt;className&gt;com.tremolosecurity.proxy.auth.FormLoginAuthMech&lt;/className&gt;

 &lt;!-- List of optional initialization parameters for the mechanism --&gt;
 &lt;init&gt;
 &lt;/init&gt;

 &lt;!-- Optional list of the parameters that are configured on the chain --&gt;
 &lt;params&gt;
  &lt;param&gt;FORMLOGIN_JSP&lt;/param&gt;
 &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
<div class="paragraph"><p>Once a mechanism is configured, its available to an authentication chain.</p></div>
</div>
<div class="sect2">
<h3 id="_authentication_chains_authchains">Authentication Chains (authChains)</h3>
<div class="paragraph"><p>Mechanisms are tied to gether in chains that allow for multiple mechanisms to be executed when a user attempts to authenticate.  This way, an application can require multiple mechanisms
for authentication.  For instance, the user may first login with a username and password, but then be required to accept tearms and conditions.  A chain can also be used for multi-factor
authentication.  Once mechanisms are available, they can be added to a chain.  The below XML shows an example chain:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- The name is how this chain is referenced in the URL --&gt;
&lt;!-- The level defines how strong an authenticaiton should be --&gt;
&lt;!-- The root defines where in the virtual directory OpenUnison should look for users. If not set, OpenUnison will look in o=Tremolo --&gt;
&lt;chain name="formlogin" level="20" root="o=Tremolo"&gt;
 &lt;!-- Each mechanism should be listed in the order that they're to be executed in --&gt;
 &lt;authMech&gt;
  &lt;!-- The name attribute of the mechanism --&gt;
  &lt;name&gt;loginForm&lt;/name&gt;

  &lt;!-- Determines how the mechanism is required.  If "required" then the chain can not succeed without this mechanism succeeding.  If "optional" then the chain can succeed if this mechanism fails --&gt;
  &lt;required&gt;required&lt;/required&gt;

  &lt;!-- List of optional parameters for the mechanism while executing the chain.  For specific mechanisms, see the Authentication Mechanisms section of  --&gt;
  &lt;params&gt;
   &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
  &lt;/params&gt;
 &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
<div class="sect3">
<h4 id="_authentication_levels">Authentication Levels</h4>
<div class="paragraph"><p>Each chain has an authentication level.  This level is used to determine how "strong" the authentication is.  If a URL is configured with a chain of a certain level, OpenUnison will
respond in one of two ways:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
If the level of the chain on the URL is HIGHER then the level the user is currently authenticated to then the user will be forced to authenticate with the chain configured on the URL
</p>
</li>
<li>
<p>
If the level of the chain on the URL is EQUAL to or LESS then the level the user is currently authenticated to then the user will NOT be forced to re-authenticate
</p>
</li>
</ol></div>
<div class="paragraph"><p>This allows you to mix and match authentication types depending on the user base.  For instance US Federal Government workers have PIV cards, but private industry might have a TOTP
credential.  By using authentication levels you can ensure they have access to the same resources.  A best practice is to assign levels in alignment with NIST 800-63 but in 10s instead
of 1s:</p></div>
<div class="ulist"><ul>
<li>
<p>
0 - Anonymous
</p>
</li>
<li>
<p>
10 - No level of assurance
</p>
</li>
<li>
<p>
20 - Some level of assurance
</p>
</li>
<li>
<p>
30 - Medium level of assurance
</p>
</li>
<li>
<p>
40 - High level of assurance
</p>
</li>
</ul></div>
<div class="paragraph"><p>This way you can differentiate between different types of authentication in the same category providing some additional room for customization.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_result_groups_resultgroups">Result Groups (resultGroups)</h3>
<div class="paragraph"><p>A result group is a collection of results that could occur because of an event.  There are four types of events -</p></div>
<div class="ulist"><ul>
<li>
<p>
Authentication Success
</p>
</li>
<li>
<p>
Authentication Failure
</p>
</li>
<li>
<p>
Authorization Success
</p>
</li>
<li>
<p>
Authorization Failure
</p>
</li>
</ul></div>
<div class="paragraph"><p>A result can be one of three actions:</p></div>
<div class="ulist"><ul>
<li>
<p>
Create a header
</p>
</li>
<li>
<p>
Create a cookie
</p>
</li>
<li>
<p>
Send a redirect
</p>
</li>
</ul></div>
<div class="paragraph"><p>Finally, a result&#8217;s value may come from one of three sources:</p></div>
<div class="ulist"><ul>
<li>
<p>
A user attribute
</p>
</li>
<li>
<p>
A static value
</p>
</li>
<li>
<p>
A custom class (com.tremolosecurity.proxy.results.CustomResult)
</p>
</li>
</ul></div>
<div class="paragraph"><p>The below is an example of a result group configuration:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- The name attribute is how the resultGroup is referenced in the URL --&gt;
&lt;resultGroup name="OnAzSuccess"&gt;
 &lt;!-- Each result should be listed --&gt;
 &lt;result&gt;
  &lt;!-- The type of result, one of cookie, header or redirect --&gt;
  &lt;type&gt;cookie&lt;/type&gt;

  &lt;!-- The source of the result value, one of user, static, custom --&gt;
  &lt;source&gt;static&lt;/source&gt;

  &lt;!-- Name of the resuler (in this case a cookie) and the value --&gt;
  &lt;value&gt;urlSuccessCookie=true&lt;/value&gt;
 &lt;/result&gt;
 &lt;result&gt;
  &lt;type&gt;header&lt;/type&gt;
  &lt;source&gt;user&lt;/source&gt;
  &lt;value&gt;result-uid=uid&lt;/value&gt;
 &lt;/result&gt;
 &lt;result&gt;
  &lt;type&gt;cookie&lt;/type&gt;
  &lt;source&gt;user&lt;/source&gt;
  &lt;value&gt;result-cookie=uid&lt;/value&gt;
 &lt;/result&gt;
 &lt;result&gt;
  &lt;type&gt;header&lt;/type&gt;
  &lt;source&gt;custom&lt;/source&gt;
  &lt;value&gt;mycustomheader=com.company.className&lt;/value&gt;
 &lt;/result&gt;
&lt;/resultGroup&gt;</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_applications_applications">Applications (applications)</h3>
<div class="paragraph"><p>Once your authentication mechanisms, chains and result groups are configured, you can configure your application.  Each application is broken into:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
URLs
</p>
</li>
<li>
<p>
Cookie Configuration
</p>
</li>
</ol></div>
<div class="paragraph"><p>Each URL comprises the components you&#8217;d expect from a URL such as host, path and transformations.  The cookie configuration defines how an application&#8217;s session is managed.  Below is
an example application configuration:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;application name="AzCheck"&gt;
  &lt;urls&gt;
   &lt;!-- The regex attribute defines if the proxyTo tag should be interpreted with a regex or not --&gt;
   &lt;!-- The authChain attribute should be the name of an authChain --&gt;
    &lt;url regex="false" authChain="formlogin"&gt;
      &lt;!-- Any number of host tags may be specified to allow for an application to work on multiple hosts.  Additionally an asterick (*) can be specified to make this URL available for ALL hosts --&gt;
      &lt;host&gt;localhost.localdomain&lt;/host&gt;

      &lt;!-- The filterChain allows for transformations of the request such as manipulating attributes and injecting headers --&gt;
      &lt;filterChain&gt;

       &lt;!-- The last mile filter the most secure mechanism OpenUnison has to integrate with a down stream application.  See the Configuration Reference for all of the filters available with OpenUnison.  NOTE: any param listed multiple times will be interpreted as a multi-value attribute --&gt;
       &lt;filter class="com.tremolosecurity.proxy.filters.LastMile"&gt;
        &lt;param name="sigKeyAlias" value="lastmile"/&gt;
        &lt;param name="encKeyAlias" value="lastmile"/&gt;
        &lt;param name="sigKeyPass" value="start123"/&gt;
        &lt;param name="encKeyPass" value="start123"/&gt;
        &lt;param name="timeScew" value="60"/&gt;
        &lt;param name="headerName" value="autoidmrequest" /&gt;
        &lt;param name="attribs" value="uid=from-assertion-uid"/&gt;
        &lt;param name="attribs" value="sn=from-assertion-sn"/&gt;
        &lt;param name="attribs" value="cn=from-assertion-cn"/&gt;
       &lt;/filter&gt;
      &lt;/filterChain&gt;

      &lt;!-- The URI (aka path) of this URL --&gt;
      &lt;uri&gt;/echo2/echo&lt;/uri&gt;

      &lt;!-- Tells OpenUnison how to reach the downstream application.  The ${} lets you set any request variable into the URI, but most of the time ${fullURI} is sufficient --&gt;
      &lt;proxyTo&gt;http://ubuntu14.tremolo.lan${fullURI}&lt;/proxyTo&gt;

      &lt;!-- List the various results that should happen --&gt;
      &lt;results&gt;
       &lt;azSuccess&gt;AzSuccessHeader&lt;/azSuccess&gt;



      &lt;/results&gt;

      &lt;!-- Determine if the currently logged in user may access the resource.  If ANY rule succeeds, the authorization succeeds.
          The scope may be one of group, dn, filter, dynamicGroup or custom
          The constraint identifies what needs to be satisfied for the authorization to pass and is dependent on the scope:
            * group - The DN of the group in OpenUnison's virtual directory (must be an instance of groupOfUniqueNames)
            * dn - The base DN of the user or users in OpenUnison's virtual directory
            * dynamicGroup - The DN of the dynamic group in OpenUnison's virtual directory (must be an instance of groupOfUrls)
            * custom - An implementation of com.tremolosecurity.proxy.az.CustomAuthorization --&gt;
      &lt;azRules&gt;
       &lt;rule scope="group" constraint="cn=staticgroup,ou=internal,ou=GenericLDAP,o=Tremolo" /&gt;
      &lt;/azRules&gt;

    &lt;/url&gt;


  &lt;/urls&gt;

  &lt;!-- The cookie configuration determines how sessions are managed for this application --&gt;
   &lt;cookieConfig&gt;
   &lt;!-- The name of the session cookie for this application.  Applications that want SSO between them should have the same cookie name --&gt;
   &lt;sessionCookieName&gt;autoIdmSession&lt;/sessionCookieName&gt;

   &lt;!-- The domain of component of the cookie --&gt;
   &lt;domain&gt;localhost.localdomain&lt;/domain&gt;

   &lt;!-- The URL that OpenUnison will interpret as the URL to end the session --&gt;
   &lt;logoutURI&gt;/echo/logoff&lt;/logoutURI&gt;

   &lt;!-- The name of the AES-256 key in the keystore to use to encrypt this session --&gt;
   &lt;keyAlias&gt;sessionKey&lt;/keyAlias&gt;

   &lt;!-- If set to true, the cookie's secure flag is set to true and the browser will only send this cookie over https connections --&gt;
   &lt;secure&gt;false&lt;/secure&gt;

   &lt;!-- The number of secconds that the session should be allowed to be idle before no longer being valid --&gt;
    &lt;timeout&gt;0&lt;/timeout&gt;
  &lt;/cookieConfig&gt;
&lt;/application&gt;</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_identity_providers">Identity Providers</h3>
<div class="paragraph"><p>OpenUnison can act as an identity provider in addition to a reverse proxy.  When an application is an identity provider, it has some minor differences with the reverse proxy:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The application can have only one URL that starts with /auth/idp/
</p>
</li>
<li>
<p>
URLs have additional configuration points:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Attribute mappings
</p>
</li>
<li>
<p>
Trusts
</p>
</li>
</ol></div>
</li>
</ol></div>
<div class="paragraph"><p>Attribute mappings are used to determine which (if any) attributes will be included in the assertion.  Trusts are used to establish the connection between the identity provider
and the service provider / relying party.  Below is an example configuration:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- Setting isApp to false indicates to OpenUnison this is an identity provider, not a proxied application --&gt;
&lt;application name="MyIdP" isApp="false"&gt;
            &lt;!-- on a single URL is allowed on an identity provider --&gt;
            &lt;urls&gt;
             &lt;!-- The regex and authChain attributes are ignored --&gt;
                &lt;url regex="false"&gt;
                 &lt;!-- Any number of host tags may be specified to allow for an application to work on multiple hosts.  Additionally an asterick (*) can be specified to make this URL available for ALL hosts --&gt;
                    &lt;host&gt;unison.enterprise.com&lt;/host&gt;

                    &lt;!-- The filterChain on an IdP is typically used to add attributes to the user prior to mapping into the assertion --&gt;
                    &lt;filterChain/&gt;

                    &lt;!-- The URI MUST start with /auth/idp/ --&gt;
                    &lt;uri&gt;/auth/idp/MyIdP&lt;/uri&gt;

                    &lt;!-- List the various results that should happen --&gt;
                    &lt;results&gt;
                        &lt;auSuccess&gt;&lt;/auSuccess&gt;
                        &lt;auFail&gt;Default Login Failure&lt;/auFail&gt;
                        &lt;azSuccess&gt;&lt;/azSuccess&gt;
                        &lt;azFail&gt;Default Login Failure&lt;/azFail&gt;
                    &lt;/results&gt;

                    &lt;!-- Determine if the currently logged in user may access the idp.  If ANY rule succeeds, the authorization succeeds.
              The scope may be one of group, dn, filter, dynamicGroup or custom
              The constraint identifies what needs to be satisfied for the authorization to pass and is dependent on the scope:
                * group - The DN of the group in OpenUnison's virtual directory (must be an instance of groupOfUniqueNames)
                * dn - The base DN of the user or users in OpenUnison's virtual directory
                * dynamicGroup - The DN of the dynamic group in OpenUnison's virtual directory (must be an instance of groupOfUrls)
                * custom - An implementation of com.tremolosecurity.proxy.az.CustomAuthorization --&gt;
                    &lt;azRules&gt;
                        &lt;rule scope="filter" constraint="(objectClass=*)"/&gt;
                    &lt;/azRules&gt;

                    &lt;!-- Defines the IdP specific portions of the application --&gt;
                    &lt;idp className="com.tremolosecurity.idp.providers.Saml2Idp"&gt;
                     &lt;!-- The alias of the certificate key used to decrypt any inbound encrypted requests --&gt;
                        &lt;params name="encKey" value=""/&gt;

                        &lt;!-- The alias of the certificate to to sign all outbound requests --&gt;
                        &lt;params name="sigKey" value="sigenc-idp-saml2-sig"/&gt;

                        &lt;!-- If set to true, requires all authnRequests to be signed --&gt;
                        &lt;params name="requireSignedAuthn" value=""/&gt;


                        &lt;!-- Determines which attributes to include in the assertion. --&gt;
                        &lt;mappings&gt;
                         &lt;!-- Each mapping focusses on a single attribute
                           targetAttributeName - The name of the attribute that will appear in the assertion
                           sourceType - One of user, static, or composite
                            * user - The name of an existing attribute on the user's object
                            * static - A static value that does not change regardless of the user
                            * composite - A mixture of user and static, allowing for one SAML attribute to be comprised of other attributes and static text.  Attributes are market as "${attributename}"
                           targetAttributeSource - The value to be used based on the sourceType
                         --&gt;
                            &lt;mapping targetAttributeName="uid" targetAttributeSource="uid" sourceType="user"/&gt;
                        &lt;/mappings&gt;

                        &lt;!-- Trusts establish a path between the IdP and SP/RP --&gt;
                        &lt;trusts&gt;
                         &lt;!-- The name of the trust, should line up with the entityID in the metadata --&gt;
                            &lt;trust name="https://mysp.partner.com/service/acs"&gt;
                             &lt;!-- Where to post assertions to, OpenUnison only supports the HTTP-Post binding --&gt;
        &lt;param name="httpPostRespURL" value="https://mysp.partner.com/service/acs"/&gt;

        &lt;!-- The name of the certificate that signed requests will be signed with --&gt;
        &lt;param name="spSigKey" value="verify-test"/&gt;

        &lt;!-- The name of the certificate that all outbound requests will be encrypted with --&gt;
        &lt;param name="spEncKey" value=""/&gt;

        &lt;!-- If no nameIDFormat is specified in the authnRequest, use this as the default --&gt;
        &lt;param name="defaultNameId" value="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"/&gt;

        &lt;!-- if no defaultAuthnContextClassRef is specified in the authenRequest is specified use this one by default --&gt;
        &lt;param name="defaultAuthCtx" value="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"/&gt;

        &lt;!-- Determines if the SP requires signed assertions --&gt;
        &lt;param name="signAssertion" value="false"/&gt;

        &lt;!-- Determines if the SP requires signed responses --&gt;
        &lt;param name="signResponse" value="true"/&gt;

        &lt;!-- Determines if the SP requires encrypted assertions --&gt;
        &lt;param name="encAssertion" value="false"/&gt;

        &lt;!-- Mapping of the nameidFormat=attribute to define which user attribute to use as the source of the nameID, may be listed multiple times for multiple nameIDFormats --&gt;
        &lt;param name="nameIdMap" value="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified=uid"/&gt;

        &lt;!-- Mapping from the authnContextClassRef to the authentication chain name used to authenticate the user --&gt;
        &lt;param name="authCtxMap" value="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport=Default Login Form"/&gt;
                            &lt;/trust&gt;
                        &lt;/trusts&gt;
                    &lt;/idp&gt;
                &lt;/url&gt;
            &lt;/urls&gt;

            &lt;!-- The cookie configuration determines how sessions are managed for this application --&gt;
            &lt;cookieConfig&gt;
             &lt;!-- The name of the session cookie for this application.  Applications that want SSO between them should have the same cookie name --&gt;
                &lt;sessionCookieName&gt;tremolosession&lt;/sessionCookieName&gt;

                &lt;!-- The domain of component of the cookie --&gt;
                &lt;domain&gt;unison.enterprise.com&lt;/domain&gt;

    &lt;!-- The URL that OpenUnison will interpret as the URL to end the session --&gt;
                &lt;logoutURI&gt;/logout&lt;/logoutURI&gt;

                &lt;!-- The name of the AES-256 key in the keystore to use to encrypt this session --&gt;
                &lt;keyAlias&gt;session-tremolosession&lt;/keyAlias&gt;

                &lt;!-- If set to true, the cookie's secure flag is set to true and the browser will only send this cookie over https connections --&gt;
                &lt;secure&gt;false&lt;/secure&gt;

                &lt;!-- The number of secconds that the session should be allowed to be idle before no longer being valid --&gt;
                &lt;timeout&gt;0&lt;/timeout&gt;
            &lt;/cookieConfig&gt;
        &lt;/application&gt;</pre>
</div></div>
<div class="sect3">
<h4 id="_custom_authorizations">Custom Authorizations</h4>
<div class="paragraph"><p>OpenUnison supports custom authorization rules that implement the com.tremolosecurity.proxy.az.CustomAuthorization interface.  Custom authorizations are defined and then referenced by
name in other areas of the OpenUnison configuration.  Below is an example of a custom authorization rule configuration:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customAzRules&gt;
 &lt;!-- The name is used to reference the rule configuration --&gt;
 &lt;!-- The className is the implementation of com.tremolosecurity.proxy.az.CustomAuthorization --&gt;
    &lt;azRule name="Manager1" className="com.tremolosecurity.provisioning.az.ManagerAuthorization"&gt;
     &lt;!-- The params tag may be listed multiple times with the same name for multi-value parameters --&gt;
        &lt;params name="numLevels" value="1"/&gt;
        &lt;params name="managerID" value="manager"/&gt;
        &lt;params name="managerIDIsDN" value="true"/&gt;
        &lt;params name="allowLowerManagers" value="false"/&gt;
    &lt;/azRule&gt;
&lt;/customAzRules&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_services">Provisioning Services</h3>
<div class="paragraph"><p>OpenUnison&#8217;s provisioning services provide a power and robust solution for user management both on a single application or as a common identity service.  OpenUnison&#8217;s platform provides:</p></div>
<div class="ulist"><ul>
<li>
<p>
Workflow Services - May be used with, or without a stateful audit database
</p>
</li>
<li>
<p>
Queue Integration - Both for reliability and for scalability
</p>
</li>
<li>
<p>
Scheduler - Build on the Quartz open source scheduler, jobs may be configured across a cluster
</p>
</li>
<li>
<p>
Provisioning Targets - Systems that will receive provisioning requests
</p>
</li>
<li>
<p>
Organizations - A way to organize workflows and reports
</p>
</li>
<li>
<p>
Reports - A simple engine for providing report data based on the audit database
</p>
</li>
<li>
<p>
URLs - Generate links for users based on their authorizations
</p>
</li>
<li>
<p>
Audit Database - Track what requests were made, what approvals were made, etc.
</p>
</li>
</ul></div>
<div class="paragraph"><p>These services can be mixed and matched to provide the identity services needed for your needs.</p></div>
<div class="sect3">
<h4 id="_workflows">Workflows</h4>
<div class="paragraph"><p>Workflows in OpenUnison are comprised of a base set of tasks and a custom task that allows for any custom logic that may be needed.  Each workflow is the coding of business logic
into an XML format.  Each workflow should have a specific set of outcomes that align to a business need.  For instance a workflow could be created to add a user to a directory,
or add a user to a group.  There are two concepts with workflows that need to be stressed:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Workflows only act on the attributes that are either passed into the workflow or loaded in a task in the workflow.  For instance if you are running a just-in-time provisioning workflow you may load attributs for a SAML2 assertion.  If adding a user to a group you may only care about the user&#8217;s unique identifier and the group being added.
</p>
</li>
<li>
<p>
Workflows can either run either synchronously OR asynchronously.  When running a request through Scale for instance, you&#8217;ll want the reliability that comes from leveraging the queue system however for a Just-in-time provisioning workflow you&#8217;ll prefer to be synchronous so you can predict when changes to the user&#8217;s accounts will occur.
</p>
</li>
</ol></div>
<div class="paragraph"><p>The workflow format its self uses a tree based structure to define the flow.  This leads to simpler implementations that can easily be scripted for large numbers of workflows that follow
the same pattern.  We specificly did NOT go with a common workflow language such as BPEL or BPM because the power that those XML formats come with also vastly increases the complexity.
We wanted something that didn&#8217;t require a GUI to write and could easily be scripted to create multiple workflows easily.</p></div>
<div class="paragraph"><p>In any workflow there will be two type os tasks:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Tasks that can have sub tasks
</p>
</li>
<li>
<p>
Tasks that can NOT have sub tasks
</p>
</li>
</ol></div>
<div class="paragraph"><p>For tasks that CAN have sub tasks the sub tasks are listed as child elements in the XML.  For instance if a an ifAttributeHasValue task is defined, it should have child elements that will
execute when the attribute and value exist on the user.</p></div>
<div class="sect4">
<h5 id="_provision">provision</h5>
<div class="paragraph"><p>This task is used to push user data to a provisioning target.  This task does NOT support sub tasks.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- sync - If true, then the target will update the object in the target to match exactly the current users object; potentially removing attributes and entitlements on the users object in the target. If false, then only the attribute values on the users object will be pushed to the target, in essence overlaying it onto the provisioning target
     target - The name of the provisioning target
     setPassword - If set to true this will create a password on the user. Note that not all targets support password, defaults to false --&gt;
&lt;provision sync="false" target="ldap2" setPassword="false" /&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_ifnotuserexists">ifNotUserExists</h5>
<div class="paragraph"><p>This task will execute sub tasks if-and-only-if there is not a user in the internal virtual directory that matches the value of the attribute specified in the current users context.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  target - The name of the provisioning target to search
  uidAttribute - The name of the attribute that contains the user's unique ID
--&gt;
&lt;ifNotUserExists target="ldap2" uidAttribute="uid"&gt;
 &lt;customTask className="com.tremolosecurity.test.util.TestTask"&gt;
  &lt;param name="configVal" value="replacecn"/&gt;
  &lt;param name="attrName" value="cn" /&gt;
 &lt;/customTask&gt;
 &lt;addGroup name="linkedSAMLUsers" /&gt;
 &lt;addAttribute name="givenName" value="addedAttrib"/&gt;
 &lt;provision sync="false" target="ldap2" /&gt;
 &lt;resync keepExternalAttrs="false" /&gt;
&lt;/ifNotUserExists&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_addattribute">addAttribute</h5>
<div class="paragraph"><p>Adds a static attribute to the user&#8217;s object</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  name - The name of the attribute to add
  value - The attribute value
--&gt;
&lt;addAttribute name="givenName" value="addedAttrib"/&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_addgroup">addGroup</h5>
<div class="paragraph"><p>Adds the named group to the user.  NOTE - The group name is NOT a distinguished
name, its a name that will be mapped to a group in a provisioning target.  This
usually means mapping to the cn attribute.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  name - The name of the group to add
--&gt;
&lt;addGroup name="linkedSAMLUsers" /&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_approval">approval</h5>
<div class="paragraph"><p>The approval step provides for a user to act on a request. and provide either
their consent or to disapprove of the request.  Each approval can have a set of
authorization rules to determine who can make the approval.  In addition to
authorizations escalation rules can be defined that let the authorization rules
change.  Finally, if all escalations are exhausted a failure policy can be defined
to allow for a request to be re-assigned or rejected.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  label - The description used to display this approval
--&gt;
&lt;approval label="Approve Access to LDAP"&gt;
    &lt;!-- Provides an email template to be sent to approvers, using ${attributeName}
         will add the attribute from the user with the given name to the email.
    --&gt;
    &lt;emailTemplate&gt;
      ${givenName},

      You have open approvals

    &lt;/emailTemplate&gt;

    &lt;!-- List of authorization rules to determine who can act on this request --&gt;
    &lt;approvers&gt;
      &lt;rule scope="group" constraint="cn=staticgroup,ou=internal,ou=GenericLDAP,o=Tremolo" /&gt;
    &lt;/approvers&gt;

    &lt;!-- If a request isn't handled in a certain amount of time, how should it be managed? --&gt;
    &lt;escalationPolicy&gt;
      &lt;!-- If no approvers are available, what to do --&gt;
      &lt;!-- action - Either "leave" to do nothing, or "assign" to assign the request to the user(s) defined in the azRules
      &lt;escalationFailure action="assign"&gt;
        &lt;azRules&gt;
          &lt;rule scope="filter" constraint="(l=NY)" /&gt;
        &lt;/azRules&gt;
      &lt;/escalationFailure&gt;

      &lt;!-- Define when this request should be escalated
          executeAfterTime - The number of units to wait until a request is escalated
          executeAfterUnits - The unit of time (sec,min,hour,day,month,year)
          validateEscalationClass - Class that is called when verifying an escalation should execute, must implement com.tremolosecurity.proxy.az.VerifyEscalation
      --&gt;
      &lt;escalation executeAfterTime="5" executeAfterUnits="sec" validateEscalationClass="com.tremolosecurity.test.provisioning.escalate.TestOverrideVerify"&gt;
        &lt;!-- for each escalation, define which users will be able to authorize the request --&gt;
        &lt;azRules&gt;
          &lt;rule scope="dn" constraint="uid=sslUser7,ou=internal,ou=GenericLDAP,o=Tremolo" /&gt;
        &lt;/azRules&gt;
      &lt;/escalation&gt;
    &lt;/escalationPolicy&gt;

&lt;!-- child processes to be called when a request is approved --&gt;
&lt;callWorkflow name="provision"&gt;&lt;/callWorkflow&gt;

  &lt;/approval&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_customtask">customTask</h5>
<div class="paragraph"><p>This task provides a mechanism by which custom logic may be added to a workflow.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  className - The name of the class that implements the com.tremolosecurity.provisioning.util.CustomTask interface
--&gt;
&lt;customTask className="com.tremolosecurity.test.util.TestTask"&gt;
  &lt;!-- Each param tag is a name/value pair for initialization.  If a param tag with the same name is listed multiple times its treated as a multi-valued attribute --&gt;
  &lt;param name="configVal" value="replacecn"/&gt;
  &lt;param name="attrName" value="cn" /&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_delete">delete</h5>
<div class="paragraph"><p>The delete task will delete a user in an individual provisioning target</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  target - The name of the provisioning target to delete the user from
--&gt;
&lt;delete target="ldap2" /&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_ifattrexists">ifAttrExists</h5>
<div class="paragraph"><p>This task will run if a user object in the workflow has a particuler attribute, regardless of the value.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  name - the name of the attribute to loog for
--&gt;
&lt;ifAttrExists name="someAttr"&gt;
  &lt;addGroup name="linkedSAMLUsers" /&gt;
  &lt;mapping  strict="true"&gt;
    &lt;provision sync="false" target="ldap2" /&gt;
    &lt;resync keepExternalAttrs="false" /&gt;
    &lt;map&gt;
      &lt;mapping targetAttributeName="uid" sourceType="user" targetAttributeSource="uid"/&gt;
      &lt;mapping targetAttributeName="cn" sourceType="user" targetAttributeSource="cn"/&gt;
      &lt;mapping targetAttributeName="sn" sourceType="user" targetAttributeSource="sn"/&gt;
    &lt;/map&gt;
  &lt;/mapping&gt;
&lt;/ifAttrExists&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_ifattrhasvalue">ifAttrHasValue</h5>
<div class="paragraph"><p>Use this tag when checking for a certain attribute value before executing a task or tasks.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  name - The name of the attribute to check
  value - The value the attribute must have
--&gt;
&lt;ifAttrHasValue name="l" value="NY"&gt;
  &lt;addGroup name="linkedSAMLUsers" /&gt;
  &lt;mapping  strict="true"&gt;
    &lt;provision sync="false" target="ldap2" /&gt;
    &lt;resync keepExternalAttrs="false" /&gt;
    &lt;map&gt;
      &lt;mapping targetAttributeName="uid" sourceType="user" targetAttributeSource="uid"/&gt;
      &lt;mapping targetAttributeName="cn" sourceType="user" targetAttributeSource="cn"/&gt;
      &lt;mapping targetAttributeName="sn" sourceType="user" targetAttributeSource="sn"/&gt;
    &lt;/map&gt;
  &lt;/mapping&gt;
&lt;/ifAttrHasValue&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_mapping">mapping</h5>
<div class="paragraph"><p>The mapping task will create a copy of the user object based on the mapping rules.  Any changes made inside of the mapping to the user
object will NOT affect the user object in the workflow outside of the mapping.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  strict - If true, the mapped user object will ONLY contain attributes explicitly named in the mapping.  If false, then any attribute not mentioned will be added to the user object with their present value.
--&gt;
&lt;mapping  strict="true"&gt;
  &lt;map&gt;
    &lt;!--
      Each mapping maps from a targetAttributeSource to the targetAttributeName
      targetAttributeName - The name of the attribute in the new user object
      targetAttributeSource - The value to be used for the new attribute
      sourceType - Describes what the targetAttributeSource is.  Possible values are:
        static - Takes the value from targetAttributeSource as is
        user - Takes the existing value from the attribute named in targetAttributeSource
        composite - Use a composite of multiple attributes and static values by containing attribute names in ${attributeName}
        custom - targetAttributeSource is the name of a class that implements com.tremolosecurity.provisioning.mapping.CustomMapping
    --&gt;
    &lt;mapping targetAttributeName="uid" sourceType="user" targetAttributeSource="uid"/&gt;
    &lt;mapping targetAttributeName="cn" sourceType="composite" targetAttributeSource="${givenName} ${sn}"/&gt;
    &lt;mapping targetAttributeName="sn" sourceType="user" targetAttributeSource="sn"/&gt;
  &lt;/map&gt;

  &lt;!-- Child tasks --&gt;
  &lt;provision sync="false" target="ldap2" /&gt;
  &lt;resync keepExternalAttrs="false" /&gt;
&lt;/mapping&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_notifyuser">notifyUser</h5>
<div class="paragraph"><p>This task provides a way to send an email to the requestor of the workflow. This can be used to notify the user of a successful execution, request more information, etc. Emails are sent from the server specified in the approvals section of the configuration.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  subject - The subject of the email notification
  mailAttribute - The name of the attribute that stores the user's email address
--&gt;
&lt;notifyUser subject="Request succeeded" mailAttrib="mail"&gt;
  &lt;!-- The message to send.  Attributes may be added between ${} --&gt;
  &lt;msg&gt;
    ${giveName},

    Your request has been approved
  &lt;/msg&gt;
&lt;/notifyUser&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_resync">resync</h5>
<div class="paragraph"><p>When executing a just-in-time provisioning workflow, for instance when using identity federation, once the users object is created in downstream targets the users object in Unison will need to be refreshed. This task updates the internal Unison object.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  keepExternalAttrs - If true, the user object will maintain any attributes that were not loaded from the internal virtual directory.
--&gt;
&lt;resync keepExternalAttrs="false" /&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_callworkflow">callWorkflow</h5>
<div class="paragraph"><p>This task allows for another workflow to be called. This allows for the creation of modular workflows. For instance a modular workflow can be created that requires 2 approvals before provisioning to a resource. This workflow can be included in a self-service request from the portal and a helpdesk application with the same results without having to duplicate the workflow.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  name - The name of the workflow to call
--&gt;
&lt;callWorkflow name="provision" /&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_queueing">Queueing</h4>
<div class="paragraph"><p>Unison uses a message queue for all asynchronous provisioning operations. The use of a message queue allows Unison to ensure that workflows are completed, even if targets such as directories and databases are down. Unison encrypts all messages sent to the queue for increased security. There are two modes that Unison can use:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Internal Queue
</p>
</li>
<li>
<p>
External Queue
</p>
</li>
</ol></div>
<div class="paragraph"><p>When Unison uses an internal queue, the queue is local to the Unison instance. This provides a simpler deployment model, but Unison servers are not able to failover in case of a failed provisioning task or spread the load across multiple servers. This is the default mode that Unison uses and no actions need to be taken to get this working after installation.</p></div>
<div class="paragraph"><p>Leveraging an external queue allows for high availability across Unison instances if a workflow fails on one server it can be picked up by another server. External queues can also increase the volume of operations Unison can handle because tasks do not need to be processed on a single box. Any message queue that supports JMS 2.0 is supported by Unison. See the certification matrix for tested and certified queues.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  isUseInternalQueue - Determines if Unison should use the internal ActiveMQ system for message management or an external system.
  encryptionKeyName - The session key used to encrypt all task messages.
  connectionFactory - Implementation of javax.jms.ConnectionFactory, only if isUserInternalQueue is false
  maxProducers - Maximum number of threads generating messages
  maxConsumers - Maximum number of threads consuming messages
  taskQueueName - The name of the queue for managing workflow tasks
  smtpQueueName - The name of the queue for managing emails generated by Unison
--&gt;
&lt;queueConfig isUseInternalQueue="false" encryptionKeyName="session-queues" connectionFactory="org.apache.activemq.ActiveMQConnectionFactory" maxProducers="5" maxConsumers="5" taskQueueName="TremoloUnisonTaskQueue" smtpQueueName="TremoloUnisonSMTPQueue"&gt;
  &lt;!--
    Each param tag maps to a setter method on the connectionFactory class.  For instance the brokerURL param tag maps to org.apache.activemq.ActiveMQConnectionFactory.setBrokerURL(String) method
  --&gt;
  &lt;param name="brokerURL" value="tcp://amq.tremolo.lan:61616/" /&gt;
&lt;/queueConfig&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_queue_listeners">Queue Listeners</h4>
<div class="paragraph"><p>In addition to workflows, Unison can provide que services to other components in Unison as well. For instance a schedule task that needs to perform work on user accounts would want to put the work load for each account in a queu, allowing the payload to be worked on by a different server in a cluster and not block the scheduled task from completing. All queue messages are encrypted with the same encryption key as workflow tasks. To implement a task, extend the com.tremolosecurity.provisioning.core.UnisonMessageListener class. Pre-built message listeners are documented in the Unison Message Listeners section.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;listeners&gt;
  &lt;!-- Each listener waits for a message to be received on the named queue using the class named. --&gt;
  &lt;listener className="com.tremolosecurity.provisioning.listeners.UpdateApprovalAZListener" queueName="rebaseQueue"&gt;&lt;/listener&gt;
  &lt;listener className="com.tremolosecurity.provisioning.listeners.AutoFailApprovalListener" queueName="failQueue"&gt;&lt;/listener&gt;
&lt;/listeners&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_scheduler">Scheduler</h4>
<div class="paragraph"><p>Unison includes an integrated scheduler that can be used to schedule task to run on a periodic basis. Unison can either use a local, in memory scheduler or a database scheduler. The database scheduler is recommended for production deployments to ensure that scheduled tasks are only executed once. Unison uses the Quartz scheduler (<a href="http://quartz-scheduler.org">http://quartz-scheduler.org</a>).</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  useDB - If true, use a database to manage jobs. NOTE: prior to starting Unison the database must be initialed per Quartz' documentation
  threadCount - The number of threads the scheduler should use. Must be at least 3
  instanceLabel - A descriptive label for this scheduler
  instanceIPMask - This field is used to determine which IP address to use on the system to identify the particular instance
--&gt;
&lt;scheduler useDB="true" threadCount="3" instanceLabel="testing" instanceIPMask="127"&gt;
  &lt;!-- This section only needed if useDB is true --&gt;
  &lt;!--
    delegateClassName - The delegate to use to work with the database
    driver - The JDBC Driver for the database
    url - The JDBC URL
    user - User to connect to database with
    password - Password to connect to database with
    maxConnections - Maximum number of connections to the database
    validationQuery - A query that can be used to verify the connection is still active
  --&gt;
  &lt;scheduleDB
    delegateClassName="org.quartz.impl.jdbcjobstore.StdJDBCDelegate"
    driver="com.mysql.jdbc.Driver"
    url="jdbc:mysql://endor.tremolo.lan/quartzDB"
    user="quartz"
    password="start123"
    maxConnections="10"
    validationQuery="SELECT 1"
  /&gt;

  &lt;!-- Each job extends com.tremolosecurity.provisioning.scheduler.UnisonJob --&gt;
  &lt;!--
    className - The name of the class
    name - Descriptive name for this scheduled job
    group - Descriptive name for a group of jobs
  --&gt;
  &lt;job className="com.tremolosecurity.provisioning.scheduler.jobs.UpdateApprovalAz" name="resetAllowedApprovers" group="testing"&gt;
    &lt;!-- All jobs use a cron based scheduler - http://www.adminschoice.com/crontab-quick-reference --&gt;
    &lt;cronSchedule
      seconds="0/9"
      minutes="*"
      hours="*"
      dayOfMonth="*"
      month="*"
      dayOfWeek="?"
      year="*"
    /&gt;
    &lt;!-- Each parameter is passed into the task on execution, params with the name name listed multiple times are treated as a multi-valued attribute --&gt;
    &lt;param name="queueName" value="rebaseQueue" /&gt;
  &lt;/job&gt;
  &lt;job className="com.tremolosecurity.provisioning.scheduler.jobs.AutoFail" name="autoFail" group="autoFail"&gt;
    &lt;cronSchedule
      seconds="0/20"
      minutes="*"
      hours="*"
      dayOfMonth="*"
      month="*"
      dayOfWeek="?"
      year="*"
    /&gt;
    &lt;param name="queueName" value="failQueue" /&gt;
    &lt;param name="approver" value="autoFail" /&gt;
    &lt;param name="message" value="failed : ${reason}" /&gt;
  &lt;/job&gt;
&lt;/scheduler&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_provisioning_targets">Provisioning Targets</h4>
<div class="paragraph"><p>Provisioning Targets are how Unison pushes, updates and disables account information in individual systems. Targets are utilized inside of workflows (covered in the next section) to manage account information. Custom targets can be created as well, to create a custom target consult the SDK. For specific information configuring targets see the Target Configuration section in this guide. Every target has a mapping associated with it. This mapping makes the target self-contained, so it may be used across multiple workflows.</p></div>
<div class="paragraph"><p>See the Provisioning Targets section in the configuration reference for the currently supported OpenUnison provisioning targets.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;targets&gt;
  &lt;!--
    name - A unique name for this target, how it is referenced throughout the configuration and code base
    className - Name of the class backing this target, must implement the com.tremolosecurity.provisioning.core.UserStoreProvider interface
  --&gt;
  &lt;target name="ldap2"
    className="com.tremolosecurity.provisioning.core.providers.LDAPProvider"&gt;
    &lt;!-- Each parameter is passed into the target on initialization.  Param tags with the name name listed multiple times are treated as a multi-valued attribute --&gt;
    &lt;params&gt;
      &lt;param name="objectClass" value="inetOrgPerson" /&gt;
      &lt;param name="host" value="127.0.0.1" /&gt;
      &lt;param name="port" value="10983" /&gt;
      &lt;param name="adminDN" value="cn=admin,dc=domain,dc=com" /&gt;
      &lt;param name="adminPasswd" value="manager" /&gt;
      &lt;param name="dnPattern" value="uid=${uid},ou=internal,dc=domain,dc=com" /&gt;
      &lt;param name="searchBase" value="dc=domain,dc=com" /&gt;
      &lt;param name="userIDAttribute" value="uid"/&gt;
      &lt;param name="useSSL" value="false"/&gt;
      &lt;param name="maxCons" value="10"/&gt;
      &lt;param name="threadsPerCons" value="10"/&gt;

    &lt;/params&gt;

    &lt;!--
      Each targetAttribute maps from a source to the name
      name - The name of the attribute in the target
      source - The value to be used for the new attribute
      sourceType - Describes what the source is.  Possible values are:
        static - Takes the value from targetAttributeSource as is
        user - Takes the existing value from the attribute named in targetAttributeSource
        composite - Use a composite of multiple attributes and static values by containing attribute names in ${attributeName}
        custom - targetAttributeSource is the name of a class that implements com.tremolosecurity.provisioning.mapping.CustomMapping
    --&gt;
    &lt;targetAttribute name="uid" sourceType="user"
      source="TREMOLO_USER_ID" /&gt;
    &lt;targetAttribute name="sn" sourceType="user"
      source="sn" /&gt;
    &lt;targetAttribute name="l" sourceType="user"
      source="l" /&gt;
    &lt;targetAttribute name="cn" sourceType="user"
      source="cn" /&gt;
    &lt;targetAttribute name="givenName"
      sourceType="user" source="givenName" /&gt;
  &lt;/target&gt;
&lt;/targets&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_organizations">Organizations</h4>
<div class="paragraph"><p>Organizations provide a way to organize workflows in a hierarchy. In a small deployment a single organization may be all thats needed, but in larger deployment it can be difficult to organize workflows. By creating organizations users can navigate through a tree to find the workflow that they need. In addition, organizations provide a mechanism to authorize users to be able to request certain workflows. For instance an organization called "Administrators" may only allow users that are a member of the administrators group to execute workflows. This makes it easier to cut down on extra approvals.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!--
  The root organization is required and should be open to all users
  name - Descriptive name of the organization
  description - Some text describing the organization
  uuid - A UUID that is unique for this organization.  This is how an organization is referenced in the configuration
--&gt;
&lt;org name="MyOrg" description="MyOrg Enterprise Applications" uuid="687da09f-8ec1-48ac-b035-f2f182b9bd1e"&gt;
  &lt;!-- Each child organization is nested as an orgs tag with the same attributes as org --&gt;
  &lt;orgs name="User Reports" description="Reports Available to All Users" uuid="1c2cad5b-f62c-491c-84f3-068f6231f053"&gt;
    &lt;!-- Each organization can have a set of authorization rules to determine which users can see this organization and anything contined in it --&gt;
    &lt;azRules/&gt;
  &lt;/orgs&gt;
  &lt;orgs name="Identity Management Reports" description="Reports only available to the Identity Management Team"   uuid="d17a59d8-11bc-44d4-994c-740194f4fd03"&gt;
    &lt;azRules&gt;
    &lt;!--
    Determine if the currently logged in user may access the organization.  If ANY rule succeeds, the authorization succeeds.
    The scope may be one of group, dn, filter, dynamicGroup or custom
    The constraint identifies what needs to be satisfied for the authorization to pass and is dependent on the scope:
      * group - The DN of the group in OpenUnison's virtual directory (must be an instance of groupOfUniqueNames)
      * dn - The base DN of the user or users in OpenUnison's virtual directory
      * dynamicGroup - The DN of the dynamic group in OpenUnison's virtual directory (must be an instance of groupOfUrls)
      * custom - An implementation of com.tremolosecurity.proxy.az.CustomAuthorization --&gt;
      &lt;rule scope="group" constraint="cn=idm-auditreports,ou=groups,o=Tremolo"/&gt;
    &lt;/azRules&gt;
  &lt;/orgs&gt;
  &lt;azRules/&gt;
&lt;/org&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_reports">Reports</h4>
<div class="paragraph"><p>Unison provides a simple reporting mechanism that can be used to provide reports via the web services API. These reports can be used by Scale or any other client via the API. Reports have the following features:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Headers Section</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Data sets can be broken out be groups and include a header section for each data set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Parameters</p></td>
<td class="tableblock halign-left valign-top" ><div><div class="literalblock">
<div class="content monospaced">
<pre>Unison reports can accept any of the four parameters:</pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
currentUser - The currently logged in user
</p>
</li>
<li>
<p>
userKey - Specify a specific user
</p>
</li>
<li>
<p>
beginDate - Date for the beginning of a date range
</p>
</li>
<li>
<p>
endDate - Date for the end of a date range
</p>
</li>
</ul></div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Authorizations</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Reports are categorized into organizations, each having an authorization</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;reports&gt;
  &lt;!--
    Each report is assigned to an organization to control access.  If a user has access to an organization, they can view the reports in that organization.
    orgID - The uuid of the org(s) tag that the report is associated with
    name - A descriptive name for the report
    description - A few words about the report
    groupings - If true, the report results will be broken up into multiple sections when the field identified by the groupBy attribute changes.
    groupBy - Determines which attribute causes a new grouping in the report when it chages
  --&gt;
  &lt;report orgID="1c2cad5b-f62c-491c-84f3-068f6231f053" name="My Open Requests" description="List of your currently open requests and the approvers responsible for acting on them" groupBy="id" groupings="true"&gt;
    &lt;!-- Any of the parameters described above, may be listed multiple times --&gt;
    &lt;paramater&gt;currentUser&lt;/paramater&gt;
    &lt;!-- The SQL that drives the report.  Each field should be aliased using "AS" to match with a headerField or dataField.  Parameters are marked using JDBC syntax using a question mark (?).  Parameters are used in the order defined in the previous parameter tag --&gt;
    &lt;sql&gt;select  approvals.id,approvals.label AS Approval ,
                 approvals.createTS AS `Approval Opened`,
                 workflows.name AS `Workflow Name`,
                 workflows.requestReason AS `Request Reason`,
                 concat(users.givenName,' ',users.sn) as `Subject Name`,
                 users.mail as `Subject Email`,
                 approvers.givenName as `First Name`,
                 approvers.sn as `Last Name`,approvers.mail as `Email`
        from approvals inner join workflows on approvals.workflow=workflows.id
                       inner join users on workflows.userid=users.id
                       inner join allowedApprovers on approvals.id=allowedApprovers.approval
                       inner join approvers on approvers.id=allowedApprovers.approver
        where users.userKey=? AND approvedTS is null
        order by approvals.createTS ASC, approvals.id ASC&lt;/sql&gt;
    &lt;!-- Fields that should be displayed in a data set's header. NOTE - fields MUST map to a field that is in the SQL SELECT clause. --&gt;
    &lt;headerFields&gt;Approval&lt;/headerFields&gt;
    &lt;headerFields&gt;Subject Name&lt;/headerFields&gt;
    &lt;headerFields&gt;Subject Email&lt;/headerFields&gt;
    &lt;headerFields&gt;Workflow Name&lt;/headerFields&gt;
    &lt;headerFields&gt;Request Reason&lt;/headerFields&gt;
    &lt;!-- Fields that should be displayed in a data set. NOTE - fields MUST map to a field that is in the SQL SELECT clause. --&gt;
    &lt;dataFields&gt;First Name&lt;/dataFields&gt;
    &lt;dataFields&gt;Last Name&lt;/dataFields&gt;
    &lt;dataFields&gt;Email&lt;/dataFields&gt;
  &lt;/report&gt;
&lt;/reports&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_urls">URLs</h4>
<div class="paragraph"><p>While Unison can provision access to applications, its also can be important to be able to tell users about what applications they have access to. To provide this, Unison has a portal URL api that can be configured on this screen. Each URL can be assigned to an organization for situations where there are hundreds of applications a user may have.</p></div>
<div class="paragraph"><p>Note: in order to include an icon in your URL you must base64 encode a 240x210 PNG file.  On *nix this is easily done via the base64 command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ cat /path/to/icon.png | base64</pre>
</div></div>
<div class="listingblock">
<div class="title">Example URL Configuration</div>
<div class="content monospaced">
<pre>&lt;portal&gt;
    &lt;!--
      Each url is listed with a urls tag
      label - What users in Scale will see
      url - The URL the browser will run when the user clicks on the icon
      name - A simple name for the URL
      org - The orgUUID of the organization to list this url in if URLs are going to be displayed via the organization tree
      icon - A base64 encoded 240x210 PNG file that will be displayed in Scale
    --&gt;
    &lt;urls label="Reset your password" url="/scale-password/" name="PasswordReset" org="8daa55cd-dd52-4fa9-8edd-09a820811d05" icon="iVBORw0KGgoAAAA..."&gt;
        &lt;!--
          The azRules will tell Unison if the link should be displayed to the user
        --&gt;
        &lt;azRules&gt;
            &lt;rule scope="dn" constraint="CN=users,ou=users,o=Tremolo"/&gt;
        &lt;/azRules&gt;
    &lt;/urls&gt;
&lt;/portal&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_audit_database">Audit Database</h4>
<div class="paragraph"><p>An audit database is required to allow for users to approve requests.  This database will track all requests, approvals (or rejections), attribute changes, etc.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;approvalDB&gt;
  &lt;!-- The JDBC Driver, must be part of the classpath --&gt;
  &lt;driver&gt;com.mysql.jdbc.Driver&lt;/driver&gt;
  &lt;!-- JDBC URL for the database --&gt;
  &lt;url&gt;jdbc:mysql://127.0.0.1:3306/unison&lt;/url&gt;
  &lt;!-- User for accessing the database --&gt;
  &lt;user&gt;unison&lt;/user&gt;
  &lt;!-- Password for the database --&gt;
  &lt;password&gt;start123&lt;/password&gt;
  &lt;!-- Maximum number of connections to the database --&gt;
  &lt;maxConns&gt;10&lt;/maxConns&gt;
  &lt;!-- Maxixum number of idle connections --&gt;
  &lt;maxIdleConns&gt;10&lt;/maxIdleConns&gt;
  &lt;!-- The name of the attribute on the user that is a unique identifier --&gt;
  &lt;userIdAttribute&gt;uid&lt;/userIdAttribute&gt;
  &lt;!-- The list of attributes to record in the approvers table.  NOTE: each value tag MUST line up with a column created on the approvers table --&gt;
  &lt;approverAttributes&gt;
    &lt;value&gt;uid&lt;/value&gt;
    &lt;value&gt;givenName&lt;/value&gt;
    &lt;value&gt;sn&lt;/value&gt;
    &lt;value&gt;mail&lt;/value&gt;
  &lt;/approverAttributes&gt;

  &lt;!-- The list of attributes to record in the users table.  NOTE: each value tag MUST line up with a column created on the users table --&gt;
  &lt;userAttributes&gt;
    &lt;value&gt;uid&lt;/value&gt;
    &lt;value&gt;givenName&lt;/value&gt;
    &lt;value&gt;sn&lt;/value&gt;
    &lt;value&gt;mail&lt;/value&gt;
  &lt;/userAttributes&gt;
  &lt;!-- determines if the audit database should be enabled, not required for using Just-In-Time provisioning --&gt;
  &lt;enabled&gt;true&lt;/enabled&gt;
  &lt;!-- The alias of the key used to encrypt all workflows stored in the database --&gt;
  &lt;encryptionKey&gt;session-workflows&lt;/encryptionKey&gt;
  &lt;!-- SMTP Server host name --&gt;
  &lt;smtpHost&gt;smtp.gmail.com&lt;/smtpHost&gt;
  &lt;!-- SMTP Server port --&gt;
  &lt;smtpPort&gt;587&lt;/smtpPort&gt;
  &lt;!-- User for accessing the SMTP server --&gt;
  &lt;smtpUser&gt;donotreply@mydomain.com&lt;/smtpUser&gt;
  &lt;!-- Password for the smtp server --&gt;
  &lt;smtpPassword&gt;********&lt;/smtpPassword&gt;
  &lt;!-- Subject of emails sent to approvers --&gt;
  &lt;smtpSubject&gt;Awaiting Approvals&lt;/smtpSubject&gt;
  &lt;!-- Email address for the "From" field of all emails --&gt;
  &lt;smtpFrom&gt;donotreply@mydomain.com&lt;/smtpFrom&gt;
  &lt;!-- Determines if TLS should be used with the SMTP server --&gt;
  &lt;smtpTLS&gt;true&lt;/smtpTLS&gt;
  &lt;!-- Set to true if an outbound SOCKS proxy is required for access to the SMTP server --&gt;
  &lt;smtpUseSOCKSProxy&gt;false&lt;/smtpUseSOCKSProxy&gt;
  &lt;!-- Host of the SOCKS proxy --&gt;
  &lt;smtpSOCKSProxyHost&gt;&lt;/smtpSOCKSProxyHost&gt;
  &lt;!-- Port of the SOCKS proxy --&gt;
  &lt;smtpSOCKSProxyPort&gt;0&lt;/smtpSOCKSProxyPort&gt;
  &lt;!-- How Unison should identify its self to the SMTP server --&gt;
  &lt;smtpLocalhost&gt;&lt;/smtpLocalhost&gt;
&lt;/approvalDB&gt;</pre>
</div></div>
<div class="sect4">
<h5 id="_database_schema">Database Schema</h5>
<div class="paragraph"><p>Unison&#8217;s provisioning model uses an open table format for storing relationships and audit data from the provisioning process. This format allows for custom reporting as well as storage in any SQL database. The below diagram and descriptions provide information on how these tables relate and provide the baseline for writing reports using you&#8217;re favorite reporting tools.</p></div>
<div class="paragraph"><p>====== users
This table lists the users and certain that attributes that have been processed. This table should be updated based on the user attributes to be tracked in reports. The only two fields in this table that are required are id and userKey. Each additional field should be the same name as an attribute in the workflow request. For instance if the givenName, sn and mail attributes are to be tracked then they should have fields in this table called givenName, sn and mail.</p></div>
<div class="paragraph"><p>====== approvers
This table lists the approvers and certain attributes that have been processed. This table should be updated based on the approver attributes to be tracked in reports. The only two fields in this table that are required are id and userKey. Each additional field should be the same name as an attribute in the workflow request. For instance if the givenName, sn and mail attributes are to be tracked then they should have fields in this table called givenName, sn and mail.</p></div>
<div class="paragraph"><p>====== targets
This table lists the name of all workflow targets as configured in the administration system. It is automaticly populated when Unison is started or the configuration is re-loaded. It should only be used for reporting and should not be updated manually.</p></div>
<div class="paragraph"><p>====== workflows
The main driving table, each row tracks a workflow and is the main table for tracking all workflows.</p></div>
<div class="paragraph"><p>====== approvals
Tracks each approval needed in a workflow. Each workflow&#8217;s state is stored in an encrypted and Base64&#8217;d object. Once the approval is complete, the workflow object is null.</p></div>
<div class="paragraph"><p>====== allowedApprovers
Link table for determining who can act on an approval. This table is primarily for use by the web service to list who can act on an approval and is populated when the approval is created in the workflow based on the rules configured in the administration system. When the approval is executed, it still checks against the rules configured in the administration system.</p></div>
<div class="paragraph"><p>====== auditLogType
This table is a lookup table for various audit log types. Its populated with the values below.</p></div>
<div class="paragraph"><p>====== auditLogs
This table tracks all changes processed by Unison&#8217;s provisioning engine.</p></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuration_reference">Configuration Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_myvd_inserts">MyVD Inserts</h3>
<div class="paragraph"><p>For documentation on MyVD and the standard MyVD inserts, see the MyVD documentation at <a href="http://myvd.sourceforge.net/">http://myvd.sourceforge.net/</a>.  The following inserts are specificly built for Unison, but many of them can be used in a standalone MyVD deployment.  All of the below inserts (unless noted) are in the unison-myvd maven module and can be used on its own.</p></div>
<div class="sect3">
<h4 id="_externalgroupmembers">ExternalGroupMembers</h4>
<div class="paragraph"><p>The External Group Members insert allows an Active Directory forest to store group members that are not a member of the forest or a trusted forest. This insert requires an attribute to be defined that will store the Unison DN of a user in the specified attribute and merge it with the uniqueMember attribute of the group.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.ad.ExternalGroupMembers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">externalGroupAttrName</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of the attribute for storing the DN, must be allowed on the group objectClass</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_corruptobjectguid">CorruptObjectGUID</h4>
<div class="paragraph"><p>This insert allows a client that tries to search on an ObjectGUID that has been cast to text improperly.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.util.CorruptObjectGUID</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_createupn">CreateUPN</h4>
<div class="paragraph"><p>Active Directory user objects dont all have user principal name objects which can interfere with directory based systems that expect them. This insert will create a userPrincipalName object based on a directory attribute and suffix.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.ad. CreateUPN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">prefixAttributeName</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of the attribute thats used as the source for the UPN; generally uid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">suffix</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The domain name to use as a suffix for the UPN</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_authtotpinsert">AuthTOTPInsert</h4>
<div class="paragraph"><p>The TOTP Authentication insert provides TOTP authentication for users who have been provisioned with a TOTP token using the CreateOTPKey custom provisioning task by adding the current key to the end of the password after a ":". So if the current code is 123456 and your password is "secret" then the correct password would be "secret:123456".</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.otp.AuthTOTPInsert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">attribute</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of the attribute that stores the token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">encryptionKey</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of the encryption key managed by Unison</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">window</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Number of 30 second windows a key should be valid for</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_uuidtotext">UUIDtoText</h4>
<div class="paragraph"><p>The objectGUID attribute is a binary attribute that is often corrupted by translation to text. This insert will translate a binary attribute to text properly.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.ad.UUIDtoText</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">attributeName</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The name of the attribute to map</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_admininsert">AdminInsert</h4>
<div class="paragraph"><p>An admin directory stores a single static user. The user in the Admin directory always has the attribute uid to identify the user. While intended for use by the administration system an Admin directory can be used to create static users in Unison.  This insert is in unison-server-core.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.admin.AdminInsert</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">uid</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The user&#8217;s login name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The user&#8217;s password</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_amazonsimpledb">AmazonSimpleDB</h4>
<div class="paragraph"><p>Unison can use Amazon SimpleDB to store user and group information. This allows for a cloud based solution with no storage or backup footprint. This can provide an extremely effective way to store cloud based identities without having to deploy a cloud based LDAP directory. In order to use this directory type you must have an Amazon Web Services account. This directory should be used in conjunction with the Amazon SimpleDB provisioning target.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class Name</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.tremolosecurity.proxy.myvd.inserts.amazon.AmazonSimpleDB</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">accessKey</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The access key generated by Amazon Web Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">secretKey</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The secret key provided by Amazon Web Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">userDomain</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The domain to store user information in</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">groupDomain</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The domain to store groups in</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_authentication_mechanisms">Authentication Mechanisms</h3>
<div class="sect3">
<h4 id="_formloginauthmech">FormLoginAuthMech</h4>
<div class="paragraph"><p>An HTML login form. All login forms must be stored in the apps/tremolo-admin/auth/forms directory. Forms can be static HTML or JSP pages. See auth/forms/defaultForm.jsp.</p></div>
<div class="sect4">
<h5 id="_mechanism">Mechanism</h5>
<div class="paragraph"><p>There are no mechanism specific configuration items.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="loginForm"&gt;
  &lt;uri&gt;/auth/formLogin&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.FormLoginAuthMech&lt;/className&gt;
  &lt;init&gt;
  &lt;/init&gt;
  &lt;params&gt;
    &lt;param&gt;FORMLOGIN_JSP&lt;/param&gt;
  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="formloginFilter" level="1"&gt;
  &lt;authMech&gt;
    &lt;name&gt;loginForm&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- Path to the login form --&gt;
      &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
      &lt;!-- Either an attribute name OR an ldap filter mapping the form parameters. If this is an ldap filter, form parameters are identified by ${parameter} --&gt;
      &lt;param name="uidAttr" value="(&amp;amp;(uid=${user})(mail=*${domain}))"/&gt;
      &lt;!-- If true, the user is determined based on an LDAP filter rather than a simple user lookup --&gt;
      &lt;param name="uidIsFilter" value="true"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_saml2auth">SAML2Auth</h4>
<div class="paragraph"><p>This mechanism is used to authenticate the user using a SAML2 assertion. The HTTP-POST and HTTP-REDIRECT profiles are supported.</p></div>
<div class="sect4">
<h5 id="_mechanism_2">Mechanism</h5>
<div class="paragraph"><p>Some identity providers, such as Active Directory Federation Services, do not have a way of providing a default RelayState for IdP Initiated SSO. In such cases, a mapping from the Referer HTTP header to a default relay state may be configured on the mechanism.  See the command line reference for how to import and export metadata easily.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="SAML2"&gt;
  &lt;uri&gt;/auth/SAML2Auth&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.SAML2Auth&lt;/className&gt;
  &lt;init&gt;
     &lt;!-- Provides a mapping from the Referal header to a default relay state, pipe (|) seperated --&gt;
     &lt;param name="defaultRelayStates" value="https://idp.ent2k12.domain.com/adfs/ls/IdpInitiatedSignOn.aspx|https://sp.autoidm.com:9090/echo/echo?roles=admin&amp;amp;myparam=value"  /&gt;
     &lt;param name="defaultRelayStates" value="https://idp.ent2k12.domain.com:443/adfs/ls/IdpInitiatedSignOn.aspx|https://sp.autoidm.com:9090/echo/echo?roles=admin&amp;amp;myparam=value"  /&gt;
  &lt;/init&gt;
  &lt;params /&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_2">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain level="1" name="adfs"&gt;
  &lt;authMech&gt;
    &lt;name&gt;SAML2&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- The assertion consumer service URL --&gt;
      &lt;param value="https://idp.ent2k12.domain.com/adfs/ls/"
        name="idpURL" /&gt;
      &lt;!-- The HTTP-Redirect endpoint --&gt;
      &lt;param value="https://idp.ent2k12.domain.com/adfs/ls/"
      name="idpRedirURL" /&gt;

      &lt;!-- The name of the certificate used to validate the signed response / assertion  --&gt;
      &lt;param
        value="verify2012"
        name="idpSigKeyName" /&gt;

      &lt;!-- The RDN for an account that can not be linked to a user in the virtual directory --&gt;
      &lt;param value="uid" name="ldapAttribute" /&gt;

      &lt;!-- The OU of an account that can not be linked to a user in the virtual directory --&gt;
      &lt;param value="ADFS" name="dnOU" /&gt;

      &lt;!-- Object Class for an account that can not be linked to a user in the virtual directory --&gt;
      &lt;param value="inetOrgPerson" name="defaultOC" /&gt;

      &lt;!-- The required authentication mechanism to be used by the identity provider --&gt;
      &lt;param name="authCtxRef" value="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"/&gt;

      &lt;!-- The certificate used to sign all outbound requests (AuthnRequest and LogoutRequest) --&gt;
      &lt;param name="spSigKey" value="spsig" /&gt;

      &lt;!-- The SingleLogout URL of the Identity Provider --&gt;
      &lt;param value="https://idp.ent2k12.domain.com/adfs/ls/"
        name="idpRedirLogoutURL" /&gt;

      &lt;!-- The final URL users are sent to after login is complete --&gt;
      &lt;param name="logoutURL" value="https://sp.autoidm.com:9090/logout" /&gt;

      &lt;!-- The algorithm used to sign AuthnRequests and LogoutRequests --&gt;
      &lt;param name="sigAlg" value="RSA-SHA256" /&gt;

      &lt;!-- The entityID of the remote identity provider --&gt;
      &lt;param name="entityID" value="https://idp.ent2k12.domain.com/adfs/services/trust" /&gt;

      &lt;!-- True if outbound requests should be signed --&gt;
      &lt;param name="signAuthnReq" value="true"/&gt;

      &lt;!-- Determine if inbound assertions must be signed --&gt;
      &lt;param name="assertionsSigned" value="true" /&gt;

      &lt;!-- Determine if inbound SAMLResponse must be signed --&gt;
      &lt;param name="responsesSigned" value="false" /&gt;

      &lt;!-- If set to true, requires inbound assertions to be encrypted --&gt;
      &lt;param name="assertionEncrypted" value="false" /&gt;

      &lt;!-- If assertionEncrypted is set to true, names the key used to decrypt the assertion --&gt;
      &lt;param name="spEncKey" value="" /&gt;

      &lt;!-- If set to true, will force outbound requests to secure connections --&gt;
      &lt;param name="forceToSSL" value="false" /&gt;

      &lt;!-- If set, provides a page notifying the user that they will be redirected to another site for authentication --&gt;
      &lt;param name="jumpPage" value="/auth/forms/jump.jsp" /&gt;

      &lt;!-- If true, OpenUnison will not attempt to find the user in the virtual directory, usually used with just-in-time provisioning --&gt;
      &lt;param name="dontLinkToLDAP" value="false" /&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_anonauth">AnonAuth</h4>
<div class="paragraph"><p>Anonymous authentication is used for scenarios when user authentication is not needed.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="anonymous"&gt;
  &lt;uri&gt;/auth/anon&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.AnonAuth&lt;/className&gt;
  &lt;init&gt;
    &lt;!-- The RDN of unauthenticated users --&gt;
    &lt;param name="userName" value="uid=Anonymous"/&gt;

    &lt;!-- Any number of attributes can be added to the anonymous user --&gt;
    &lt;param name="role" value="Users" /&gt;
  &lt;/init&gt;
  &lt;params&gt;

  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
<div class="sect4">
<h5 id="_chain_3">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- An anonymous authentication chain MUST be level 0 --&gt;
&lt;chain name="anon" level="0"&gt;
  &lt;authMech&gt;
    &lt;name&gt;anonymous&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;&lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_basicauth">BasicAuth</h4>
<div class="paragraph"><p>HTTP Basic Authentication</p></div>
<div class="sect4">
<h5 id="_mechanism_3">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="basicAuth"&gt;
  &lt;uri&gt;/auth/basic&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.BasicAuth&lt;/className&gt;
  &lt;init&gt;
  &lt;/init&gt;
  &lt;params&gt;
    &lt;param&gt;realmName&lt;/param&gt;
  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_4">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="basicLogin" level="1"&gt;
  &lt;authMech&gt;
    &lt;name&gt;basicAuth&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- The name of the realm to present to the user --&gt;
      &lt;param name="realmName" value="Tremolo Realm"/&gt;
      &lt;!-- The name of the attribute to use when looking for the user --&gt;
      &lt;param name="uidAttr" value="uid"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_iwaauth">IWAAuth</h4>
<div class="paragraph"><p>IWA, or Integrated Windows Authentication, allows a user to authenticate using their current windows Kerberos token. For IWA to work the user MUST be logged into a desktop that is a member of one of the domains configured on this mechanism. NTLM is NOT supported.</p></div>
<div class="sect4">
<h5 id="_mechanism_4">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="IWA"&gt;
  &lt;uri&gt;/auth/iwa&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.IWAAuth&lt;/className&gt;
  &lt;init&gt;
    &lt;!-- The fully qualified domain name of the domain --&gt;
    &lt;param name="domain" value="ENTERPRISE.DOMAIN.COM"/&gt;

    &lt;!-- The hostname or IP of the KDC --&gt;
    &lt;param name="ENTERPRISE.DOMAIN.COM.kdc" value="kdc.tremolo.lan"/&gt;

    &lt;!-- The service account to use --&gt;
    &lt;param name="ENTERPRISE.DOMAIN.COM.userName" value="tremoloSvc@ENTERPRISE.DOMAIN.COM"/&gt;

    &lt;!-- The service account password --&gt;
    &lt;param name="ENTERPRISE.DOMAIN.COM.password" value="$ecret"/&gt;
  &lt;/init&gt;
  &lt;params&gt;
    &lt;param&gt;realmName&lt;/param&gt;
  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_5">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="iwa" level="1" &gt;
  &lt;authMech&gt;
    &lt;name&gt;IWA&lt;/name&gt;
    &lt;required&gt;sufficient&lt;/required&gt;
    &lt;params&gt;&lt;/params&gt;
  &lt;/authMech&gt;
  &lt;!-- Fallback to form if IWA isn't available --&gt;
  &lt;authMech&gt;
    &lt;name&gt;loginForm&lt;/name&gt;
    &lt;required&gt;sufficient&lt;/required&gt;
    &lt;params&gt;
      &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_certauth">CertAuth</h4>
<div class="paragraph"><p>This mechanism supports authentication using SSL certificates. If the certificate can be associated with a user in the directory it will be, otherwise a user object is created. Note that in order for sslCert mechanisms to work certificate authentication must either be optional or required on the container.</p></div>
<div class="sect4">
<h5 id="_mechanism_5">Mechanism</h5>
<div class="paragraph"><p>Certificate Revocation Lists are configured on the mechanism. There are three types of CRLs: file based, LDAP and OCSP.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="sslCert"&gt;
  &lt;uri&gt;/auth/ssl&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.CertAuth&lt;/className&gt;
  &lt;init&gt;
    &lt;!-- Comma seperated list of CRLs to check --&gt;
    &lt;param name="crl.names" value="openssl,ldapcrl,ocsp"/&gt;

    &lt;!-- CRLs are loaded once a minute --&gt;
    &lt;param name="crl.openssl.type" value="com.tremolosecurity.proxy.auth.ssl.FileCRL"/&gt;
    &lt;!-- Path to the CRL file --&gt;
    &lt;param name="crl.openssl.path" value="crl.pem"/&gt;

    &lt;!-- For checking a CRL stored in an LDAP object --&gt;
    &lt;param name="crl.ldapcrl.type" value="com.tremolosecurity.proxy.auth.ssl.LdapCRL"/&gt;
    &lt;param name="crl.ldapcrl.path" value="ldap://127.0.0.1:10983/cn=signing,ou=internal,dc=domain,dc=com"/&gt;

    &lt;!-- For checking against OCSP --&gt;
    &lt;param name="crl.ocsp.type" value="com.tremolosecurity.proxy.auth.ssl.OCSP"/&gt;
    &lt;param name="crl.ocsp.path" value="http://127.0.0.1:2389"/&gt;
  &lt;/init&gt;
  &lt;params&gt;&lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_6">Chain</h5>
<div class="paragraph"><p>When authenticating a user using certificates the chain configuration specifies how to identify a user and link them to a user in the directory. If a user cant be linked in the directory then a user object is created based on the components of the DN.</p></div>
<div class="paragraph"><p>When a certificate has subject alternative names they are added as potential components or attributes. These attribute names are:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
otherName
</p>
</li>
<li>
<p>
email
</p>
</li>
<li>
<p>
dNSName
</p>
</li>
<li>
<p>
x400Address
</p>
</li>
<li>
<p>
directoryName
</p>
</li>
<li>
<p>
ediPartyName
</p>
</li>
<li>
<p>
uniformResourceIdentifier
</p>
</li>
<li>
<p>
iPAddress
</p>
</li>
<li>
<p>
registeredID
</p>
</li>
</ol></div>
<div class="paragraph"><p>Any of these attributes are available to the matching filter for directory lookups or in the DN of an unmatched entry.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="sslClientAuth" level="1"&gt;
  &lt;authMech&gt;
    &lt;name&gt;sslCert&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- Either an attribute name OR an ldap filter mapping the certificate dn components. If this is an ldap filter, dn components are identified by ${component} --&gt;
      &lt;param name="uidAttr" value="(uid=${CN})" /&gt;
      &lt;!-- If the UID Attribute is a filter or just an attribute name   --&gt;
      &lt;param name="uidIsFilter" value="true"/&gt;
      &lt;!-- A list of attributes in the certificate subject, or subject alternative names, that will be the RDN of an unmatched entry. --&gt;
      &lt;param name="rdnAttribute" value="CN" /&gt;
      &lt;!-- The object class to use for objects created because the user doesnt exist in the directory --&gt;
      &lt;param name="defaultOC" value="inetOrgPerson" /&gt;

      &lt;!-- The ou component of the DN to use for users not matched. For instance if SSL is specified the users dn would be uid=user,ou=SSL,o=Tremolo --&gt;
      &lt;param name="dnLabel" value="ou=CertAuth"/&gt;

      &lt;!-- List of DNs of trusted certificates that the chain will accept --&gt;
      &lt;param name="issuer" value="OU=Dev, O=Tremolo Security Inc., C=US, ST=Virginia, CN=Root CA"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_useronlyauthmech">UserOnlyAuthMech</h4>
<div class="paragraph"><p>An HTML login form that ONLY collects a username. This mechanism is convinient when using a custom authentication scheme or authentication system that doesn&#8217;t have a password (like SMS). All login forms must be stored in the auth/forms directory. Forms can be static HTML or JSP pages. See auth/forms/userOnlyLogin.jsp.</p></div>
<div class="sect4">
<h5 id="_mechanism_6">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="userOnlyForm"&gt;
  &lt;uri&gt;/auth/userOnlyLogin&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.UserOnlyAuthMech&lt;/className&gt;
  &lt;init&gt;
  &lt;/init&gt;
  &lt;params&gt;
    &lt;param&gt;FORMLOGIN_JSP&lt;/param&gt;
  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_7">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="userOnlyLoginChain" level="1"&gt;
  &lt;authMech&gt;
    &lt;name&gt;userOnlyForm&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!--   The URI for the jsp page used to log the user in --&gt;
      &lt;param name="loginJSP" value="/auth/forms/userOnlyLogin.jsp
      &lt;!-- Either an attribute name OR an ldap filter mapping the form parameters. If this is an ldap filter, form parameters are identified by ${parameter} --&gt;
      &lt;param name="uidAttr" value="uid"/&gt;
      &lt;!-- If true, the user is determined based on an LDAP filter rather than a simple user lookup   --&gt;
      &lt;param name="uidIsFilter" value="false"/&gt;
      &lt;!-- The URI for the jsp page used when a user can't be found --&gt;
      &lt;param name="noUserJSP" value="/auth/forms/noUser.jsp"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_acknowledgeauthmech">AcknowledgeAuthMech</h4>
<div class="paragraph"><p>The Banner Acknowledge mechanism provides a way to make a user acknowledge a set of policies prior to logging in. Adding this mechanism to a chain to record the acknowledgement in the authorization logs. The stock acknowledgement form is in /auth/forms/acknowledge.jsp.</p></div>
<div class="sect4">
<h5 id="_mechanism_7">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="acknowledge"&gt;
  &lt;uri&gt;/auth/acknowledge&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.AcknowledgeAuthMech&lt;/className&gt;
  &lt;init&gt;
  &lt;/init&gt;
  &lt;params&gt;
  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_8">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="login" level="1"&gt;
  &lt;!-- First authenticate the user's identity --&gt;
  &lt;authMech&gt;
    &lt;name&gt;loginForm&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
  &lt;authMech&gt;
    &lt;name&gt;acknowledge&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- The URI for the jsp page to host the banner and request acknowledgement   --&gt;
      &lt;param name="loginJSP" value="/auth/forms/acknowledge.jsp"/&gt;
      &lt;!-- The text of the banner, may be HTML  --&gt;
      &lt;param name="banner" value="I acknowledge that I shall do no harm"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_twiliosms">TwilioSMS</h4>
<div class="paragraph"><p>This mechanism allows for single use password to be used and sent over SMS to a users mobile phone via Twilio. Note, a Twilio account is required to use this mechanism.</p></div>
<div class="sect4">
<h5 id="_mechanism_8">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="smsAuth"&gt;
  &lt;uri&gt;/auth/smsAuth&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.otpsms.TwilioSMS&lt;/className&gt;
  &lt;init&gt;&lt;/init&gt;
  &lt;params&gt;&lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_9">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="2fasms" level="2"&gt;
  &lt;!-- First collect the user's identity --&gt;
  &lt;authMech&gt;
    &lt;name&gt;loginForm&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
  &lt;authMech&gt;
    &lt;name&gt;smsAuth&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- Twilio Account SID   --&gt;
      &lt;param name="accountSID" value=""/&gt;
      &lt;!-- Twilio Account token --&gt;
      &lt;param name="authToken" value="" /&gt;
      &lt;!--   Twilio Source Phone Number --&gt;
      &lt;param name="fromNumber" value="1234567890" /&gt;
      &lt;!-- The attribute that stores the users phone number   --&gt;
      &lt;param name="toAttrName" value="mobile"/&gt;
      &lt;!-- URI for the form to collect the login key  --&gt;
      &lt;param name="redirectForm" value="/auth/forms/smsKey.jsp"/&gt;=
      &lt;!-- The message to be sent to the user. ${key} is used to represent the single use password.  --&gt;
      &lt;param name="message" value="${key}"/&gt;
      &lt;!-- The length of the single use password  --&gt;
      &lt;param name="keyLength" value="10"/&gt;
      &lt;!-- Checked if the single use password will have upper case letters   --&gt;
      &lt;param name="useLowerCase" value="true"/&gt;
      &lt;!-- Checked if the single use password will have lower case letters   --&gt;
      &lt;param name="useUpperCase" value="false"/&gt;
      &lt;!-- Checked if the single use password will have numbers   --&gt;
      &lt;param name="useNumbers" value="true"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_secretquestionauth">SecretQuestionAuth</h5>
<div class="paragraph"><p>This mechanism allows for secret or golden to be used as a password. The answers are stored in JSON as an attribute on the users object and are hashed. All questions and answers are encrypted.  NOTE: this mechanism is designed to be used with the com.tremolosecurity.proxy.auth.secret.CreateSecretQuestionsTask provisioning task.</p></div>
</div>
<div class="sect4">
<h5 id="_mechanism_9">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="SecretQuestions"&gt;
  &lt;uri&gt;/auth/secretQuestions&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.secret.SecretQuestionAuth&lt;/className&gt;
  &lt;init&gt;
    &lt;!-- List of questions --&gt;
    &lt;param name="questionList" value="What is your favorite team?"/&gt;
    &lt;param name="questionList" value="What is your favorite color?"/&gt;
    &lt;param name="questionList" value="What is your favorite pet?"/&gt;
    &lt;param name="questionList" value="What is your favorite town?"/&gt;
    &lt;param name="questionList" value="What is your favorite candy?"/&gt;
  &lt;/init&gt;
  &lt;params&gt;
  &lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_10">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="formlogin" level="1"&gt;
  &lt;!-- First collect the user's identity, could also be the UserOnlyAuthMech --&gt;
  &lt;authMech&gt;
    &lt;name&gt;loginForm&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
  &lt;authMech&gt;
    &lt;name&gt;SecretQuestions&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- The attribute that stores the base64 encoded json   --&gt;
      &lt;param name="questionAttr" value="jpegPhoto"/&gt;
      &lt;!-- The URI of the secret question answer form  --&gt;
      &lt;param name="loginForm" value="/auth/forms/secretQuestions.jsp"/&gt;
      &lt;!-- One way hash to use --&gt;
      &lt;param name="alg" value="SHA-512"/&gt;
      &lt;!-- Used to randomize the hash  --&gt;
      &lt;param name="salt" value="I love tremolo security!"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_loginservice">LoginService</h4>
<div class="paragraph"><p>The Login Service mechanism provides a way to give users a choice in how they login. This is useful in situations where the user could have multiple tokens and different levels of authentication. For instance, in a scenario where a user might be able to use 2-factor authentication when they have a token or a single factor when they don&#8217;t.</p></div>
<div class="paragraph"><p>The way the login service works is it redirects the user to another Application URL for authentication. Once the chain for that application URL is completed the user is re-directed back to the original request (with post preservation). This provides the advantage of providing the authentication level of the desired chain. Each application URL should be configured with the com.tremolosecurity.prelude.filters.CompleteLogin filter. This will complete the login process.</p></div>
<div class="sect4">
<h5 id="_mechanism_10">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="LoginService"&gt;
  &lt;uri&gt;/auth/loginService&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.LoginService&lt;/className&gt;
  &lt;init&gt;
  &lt;/init&gt;
  &lt;params&gt;&lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_11">Chain</h5>
<div class="paragraph"><p>This mechanism should be the ONLY mechanism on a chain. In addition, the chain should be set at the lowest level of the other authentication chains involved. For instance if a chain on /login/ssl is set at 40 and another chain on /login/form is set at 20 then this chain should be 20.</p></div>
<div class="paragraph"><p>For each login choice, the steps are</p></div>
<div class="ulist"><ul>
<li>
<p>
Create an authentication chain
</p>
</li>
<li>
<p>
Create an Application URL
</p>
</li>
<li>
<p>
Associate the URL with the chain
</p>
</li>
<li>
<p>
On the Application URL, add the com.tremolosecurity.prelude.filters.CompleteLogin filter
</p>
</li>
<li>
<p>
Add the URI for this URL to the chain configuration for the login service
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain level="1" name="LoginService"&gt;
    &lt;authMech&gt;
      &lt;name&gt;LoginService&lt;/name&gt;
      &lt;required&gt;required&lt;/required&gt;
      &lt;params&gt;
        &lt;!-- chains parameters point to the login endpoint for a choice and the label for the user's form --&gt;
        &lt;param name="chains" value="SAML2 Login=/login/saml2" /&gt;
        &lt;param name="chains" value="Username and Password=/login/form" /&gt;
        &lt;!-- The URI of the login method select page   --&gt;
        &lt;param name="serviceUrl" value="/auth/forms/chooseLogin.jsp" /&gt;
        &lt;!-- The name of the cookie to store the user's decision to keep the user's decision to save the choice.   --&gt;
        &lt;param name="cookieName" value="tremoloLoginChoice"/&gt;
        &lt;!-- The number of days the cookie that determines if the user wants to remember their login choice will be valid.   --&gt;
        &lt;param name="cookieDays" value="30" /&gt;
      &lt;/params&gt;
    &lt;/authMech&gt;
  &lt;/chain&gt;
&lt;/authChains&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_oauth2bearerlastmile">OAuth2BearerLastMile</h4>
<div class="paragraph"><p>This mechanism allows for the use of a Unison Last Mile token to be used as a bearer token for OAuth2. The token must have one attribute named dn that maps to the user&#8217;s DN in Unison&#8217;s virtual directory.</p></div>
<div class="sect4">
<h5 id="_mechanism_11">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="oauth2"&gt;
    &lt;uri&gt;/auth/oath2&lt;/uri&gt;
    &lt;className&gt;com.tremolosecurity.proxy.auth.oauth2.OAuth2BearerLastMile&lt;/className&gt;
    &lt;init&gt;&lt;/init&gt;
    &lt;params&gt;&lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_12">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="oauth2" level="5"&gt;
   &lt;authMech&gt;
       &lt;name&gt;oauth2&lt;/name&gt;
       &lt;required&gt;required&lt;/required&gt;
       &lt;params&gt;
           &lt;!-- The realm for the bearer tokern --&gt;
           &lt;param name="realm" value="MyEntWS" /&gt;
           &lt;!-- The scope of the token --&gt;
           &lt;param name="scope" value="Mobile" /&gt;
           &lt;!-- The encryption key used to decrypt the token --&gt;
           &lt;param name="encKeyAlias" value="sessionkey" /&gt;
       &lt;/params&gt;
   &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_jitauthmech">JITAuthMech</h4>
<div class="sect4">
<h5 id="_mechanism_12">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="jit"&gt;
    &lt;uri&gt;/auth/oath2&lt;/uri&gt;
    &lt;className&gt;com.tremolosecurity.provisioning.auth.JITAuthMech&lt;/className&gt;
    &lt;init&gt;&lt;/init&gt;
    &lt;params&gt;&lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_13">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="jit" level="5"&gt;
   &lt;!-- first run an authentication mechanism, such as SAML2, to validate the user and retrieve attributes --&gt;
   &lt;authMech&gt;
       &lt;name&gt;JIT&lt;/name&gt;
       &lt;required&gt;required&lt;/required&gt;
       &lt;params&gt;
           &lt;!-- The name of the attribute that will be used as the user identifier--&gt;
           &lt;param name="nameAttr" value="uid" /&gt;
           &lt;!-- The name of the workflow --&gt;
           &lt;param name="workflowName" value="JIT-Saml2" /&gt;
       &lt;/params&gt;
   &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_persistentcookie">PersistentCookie</h4>
<div class="paragraph"><p>he persistent cookie mechanism is used in situations where a heavy gui client (such as Office or Windows Explorer) uses http calls to do work but is unable to handle redirects or form based authentication. For instance when integrating with a webdav system that is protected by Unison. Using this mechanism, a user can be authenticated in a web browser but use Explorer or Office using a persistent cookie. This cookie is encrypted and has a certain lifespan beyond the life of the user&#8217;s Unison session.</p></div>
<div class="paragraph"><p>To enhance security this mechanism uses three levels of security:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:50%;">
<col style="width:50%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">AES-256 Encryption</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The cookie is encrypted using industry standard AES with 256 bit keys</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Client IP Address</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The user&#8217;s IP address is stored in the cookie, if the IP of the source of a request doesn&#8217;t match this value the cookie is rejected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Optional - SSL Session ID</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The session id for the current SSL session can be stored as an extra layer of validation</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>When using this mechanism, the com.tremolosecurity.proxy.auth.persistentCookie.PersistentCookieResult custom result must be a cookie result on a Result Group that is on the Authentication Success result of the application configured with this mechanism.</p></div>
<div class="paragraph"><p>Finally, when using with internet explorer the site that will generate and use this cookie MUST be "Trusted".</p></div>
<div class="sect4">
<h5 id="_mechanism_13">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="persistentCookie"&gt;
    &lt;uri&gt;/auth/cookie&lt;/uri&gt;
    &lt;className&gt;com.tremolosecurity.proxy.auth.persistentCookie.PersistentCookie&lt;/className&gt;
    &lt;init&gt;&lt;/init&gt;
    &lt;params&gt;&lt;/params&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_14">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="saml2Test" level="1"&gt;
    &lt;!-- Persistent Cookie should be first and marked as sufficient --&gt;
    &lt;authMech&gt;
        &lt;name&gt;persistentCookie&lt;/name&gt;
        &lt;required&gt;sufficient&lt;/required&gt;
        &lt;params&gt;
            &lt;!-- The name of the cookie to generate. Scoping information is taken from the application's cookie configuration.  --&gt;
            &lt;param name="cookieName" value="login" /&gt;
            &lt;!-- The number of milliseconds before this cookie needs to be re-generated. Defaults to 4 hours.   --&gt;
            &lt;param name="millisToLive" value="10000" /&gt;
            &lt;!-- The name of the Last Mile Key from the Certificate Management screen to use to encrypt the cookie   --&gt;
            &lt;param name="keyAlias" value="lastmile" /&gt;
            &lt;!-- If true, the user's ssl session id is included in the validation process.--&gt;
            &lt;param name="useSSLSessionID" value="true" /&gt;
        &lt;/params&gt;
    &lt;/authMech&gt;
  &lt;authMech&gt;
  &lt;name&gt;saml2Test&lt;/name&gt;
  &lt;required&gt;sufficient&lt;/required&gt;
  &lt;params&gt;
    &lt;param name="idpURL" value="http://shib2x.tremolo.lan/idp/profile/SAML2/POST/SSO" /&gt;
    &lt;param name="idpRedirURL" value="http://shib2x.tremolo.lan/idp/profile/SAML2/Redirect/SSO" /&gt;
    &lt;param name="idpSigKeyName" value="shib-idp-sig"/&gt;
    &lt;param name="ldapAttribute" value="uid"/&gt;
    &lt;param name="dnOU" value="SAML2Test"/&gt;
    &lt;param name="defaultOC" value="inetOrgPerson"/&gt;
    &lt;param name="authCtxRef" value="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"/&gt;
  &lt;/params&gt;
&lt;/authMech&gt;</pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_otpauth">OTPAuth</h4>
<div class="paragraph"><p>This mechanism provides a one-time-password using the OATH time based protocol (sometimes referred to as Google Authenticator). This mechanism needs to be paired with a workflow that contains the com.tremolosecurity.provisioning.customTasks.CreateOTPKey custom task for setting the user&#8217;s encrypted key.</p></div>
<div class="sect4">
<h5 id="_mechanism_14">Mechanism</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;mechanism name="totp"&gt;
  &lt;uri&gt;/auth/totp&lt;/uri&gt;
  &lt;className&gt;com.tremolosecurity.proxy.auth.otp.OTPAuth&lt;/className&gt;
  &lt;init&gt;
  &lt;/init&gt;
&lt;/mechanism&gt;</pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_chain_15">Chain</h5>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;chain name="login" level="1"&gt;
  &lt;authMech&gt;
    &lt;!-- First authenticate the user --&gt;
    &lt;name&gt;loginForm&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;param name="FORMLOGIN_JSP" value="/auth/forms/defaultForm.jsp"/&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
  &lt;authMech&gt;
    &lt;name&gt;totp&lt;/name&gt;
    &lt;required&gt;required&lt;/required&gt;
    &lt;params&gt;
      &lt;!-- The path to the form for entering the one-time-password       --&gt;
      &lt;param name="formURI" value="/auth/forms/otp.jsp"   /&gt;
      &lt;!-- The last mile key used to encrypt the user's token    --&gt;
      &lt;param name="keyName" value="sessionkey"   /&gt;
      &lt;!-- The name of the attribute to retreive the user's token from, should be the same as the attributeName property of the com.tremolosecurity.provisioning.customTasks.CreateOTPKey custom task --&gt;
      &lt;param name="attributeName" value="givenName" /&gt;
      &lt;!-- Number of valid 30 second windows that a token should remain usable for cases where clocks aren't exactly in-sync or to forgive codes entered over a windows switch --&gt;
      &lt;param name="windowSize" value="4" /&gt;
    &lt;/params&gt;
  &lt;/authMech&gt;
&lt;/chain&gt;</pre>
</div></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_filters">Filters</h3>
<div class="paragraph"><p>Unison provides the capability to make changes to each request. For an identity provider this typically means adding additional attributes to an assertion. For a reverse proxy, this generally means adding headers or executing workflows based on the user&#8217;s choices. The below filters come standard in OpenUnison.</p></div>
<div class="sect3">
<h4 id="_group2attribute">Group2Attribute</h4>
<div class="paragraph"><p>This filter allows for an attribute to be added to an assertion if the user is a member of a particular group in your directory. This could be useful when providing service providers entitlement information. This filter can be added multiple times and if the user is a member of the specified group AND the attribute already exists the specified value is added to the attribute, it does not replace it.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.prelude.filters.Group2Attribute"&gt;
  &lt;!-- The name of the attribute to create if the user is a member of this group        --&gt;
        &lt;param name="attributeName" value="roles"/&gt;
  &lt;!-- The value to be added or set if the user is a member of the specified group      --&gt;
        &lt;param name="attributeValue" value="admin"/&gt;
  &lt;!-- The full LDAP DN of the group being checked. This DN must be the mapped DN from inside of Unison. The  button next to this option may be used to search for the group based on its CN.       --&gt;
        &lt;param name="groupDN" value="cn=staticgroup,ou=internal,ou=GenericLDAP,o=Tremolo" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_dnbase2attribute">DNBase2Attribute</h4>
<div class="paragraph"><p>This filter allows for an attribute to be added to an assertion if the user&#8217;s DN in the virtual directory is a child of the specified DN. This could be useful when providing service providers entitlement information. This filter can be added multiple times and if the user is a member of the specified DN AND the attribute already exists the specified value is added to the attribute, it does not replace it.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.prelude.filters.DNBase2Attribute"&gt;
  &lt;!-- The name of the attribute to create if the user is a member of this group        --&gt;
        &lt;param name="attributeName" value="roles"/&gt;
  &lt;!-- The value to be added or set if the user is a member of the specified group      --&gt;
        &lt;param name="attributeValue" value="admin"/&gt;
  &lt;!-- The full LDAP DN of the base being checked. This DN must be the mapped DN from inside of Unison.                 --&gt;
        &lt;param name="dn" value="cn=Users,ou=MyEnterprise,O=Tremolo" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_logintest">LoginTest</h4>
<div class="paragraph"><p>This filter will echo the attributes of the currently logged in user. It&#8217;s a convinient way to test the login process without having to have an application to proxy or an identity provider configured. Configure this filter on a URL and that URL will use this filter to provide content back to the web browser. No filters configured after this filter are executed.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.prelude.filters.LoginTest"&gt;
  &lt;!-- The path of the logout URI               --&gt;
        &lt;param name="logoutURI" value="/logout"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_xforward">XForward</h4>
<div class="paragraph"><p>The X-Forward headers (X-Forwarded-For, X-Forwarded-Host and X-Forwarded-Proto), are a defacto standard for supplying down-stream servers with information as a reverse proxy would see it. This filter will create these attributes for use as headers.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.XForward"&gt;
  &lt;!-- Determine if plain HTTP Headers or Secure Headers should be used. If checked, standard headers are created, if not checked then attributes are created with the same names that can be added as Secure Headers to the LastMile filter.           --&gt;
        &lt;param name="createHeaders" value="false"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_createawsroleattribute">CreateAWSRoleAttribute</h4>
<div class="paragraph"><p>This filter is designed to be added to an identity provider for the AWS console to create an attribute that is acceptable to AWS out of human readable role names.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.custom.CreateAWSRoleAttribute"&gt;
  &lt;!-- The name of an attribute on the user object that contains all of the names of roles to be included in the assertion. NOTE: each role should exist in IAM or the authentication will fail. --&gt;
        &lt;param name="sourceAttribute" value="roleNames"/&gt;
  &lt;!-- The AWS account number that should be included in the role mapping.      --&gt;
  &lt;param name="idpName" value="1234567"/&gt;
  &lt;!-- The name of the identity provider in your AWS IAM configuration to bind to.      --&gt;
  &lt;param name="accountNumber" value="MyIdp"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_stopprocessing">StopProcessing</h4>
<div class="paragraph"><p>The Stop Processing filter will stop all processing, not executing any filters configured after it or sending a request to the proxied server. This filter has no configuration options</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.prelude.filters.StopProcessing" /&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_executeworkflow">ExecuteWorkflow</h4>
<div class="paragraph"><p>This insert will execute a workflow using the user loaded by the authentication process.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.ExecuteWorkflow"&gt;
  &lt;!-- The name of the workflow to execute       --&gt;
        &lt;param name="workflowName" value="jitdbwf" /&gt;
  &lt;!-- The name of the attribute on the user object used to identify the user   --&gt;
        &lt;param name="uidAttributeName" value="uid" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_usertojson">UserToJSON</h4>
<div class="paragraph"><p>This filter will create a JSON object based on the users attributes. The class com.tremolosecurity.proxy.auth.AuthInfo is serialized into JSON into the attribute UserJSON. This attribute can then be used as a header in a result or a LastMile attribute.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.UserToJSON"&gt;
  &lt;!-- If set to true the request is continued to be proxied. If set to false, the request completes      --&gt;
  &lt;param name="doProxy" value="false" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_azfilter">AzFilter</h4>
<div class="paragraph"><p>If an application is configured to not use a session, the users context may be set in a filter but the authorization process will not be executed. This filter will execute authorization rules and execute result groups in this scenario. There are no configuration options for this filter, as it uses the rules configured on the application.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.AzFilter" /&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_remotebasic">RemoteBasic</h4>
<div class="paragraph"><p>This filter will authenticate users by executing a basic authentication request against a remote server using the Authorization header inbound from the browser. The filter will then set the users context. Its designed to work with an applications session disabled.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.RemoteBasic"&gt;
  &lt;!-- The name of the realm on the remote web server the authentication is against     --&gt;
        &lt;param name="realmName" value="Tremolo Basic Realm"/&gt;
  &lt;!-- The url to use to test the authentication        --&gt;
        &lt;param name="url" value="http://localhost.localdomain:9090/echo/echo4"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_lastmile">LastMile</h4>
<div class="paragraph"><p>The last mile security filter generates the token utilized to validate the request by the Last Mile system deployed on the application. This filter can be configured to add attributes, roles and other information to the last mile token. It also supplies the configuration needed for the applications last mile configuration.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.LastMile"&gt;
  &lt;!-- The key used to encrypt the last mile header     --&gt;
  &lt;param value="lastmile-userreg" name="encKeyAlias" /&gt;
  &lt;!-- The number of milliseconds that the last mile token is valid     --&gt;
        &lt;param value="1000" name="timeScew" /&gt;
  &lt;!-- The name of the header   --&gt;
        &lt;param value="tremoloHeader" name="headerName" /&gt;
  &lt;!-- Each attribs lists a mapping from a user attribute to the attribute in the last mile token --&gt;
  &lt;param value="uid=displayName" name="attribs" /&gt;
        &lt;param value="uid=mail" name="attribs" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_checkadshadowaccounts">CheckADShadowAccounts</h4>
<div class="paragraph"><p>When integrating with an AD environment that is used for both shadow accounts and real accounts this filter is used to transition from real account in an external forest to a shadow account.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.CheckADShadowAccounts"&gt;
  &lt;!-- The UPN suffix for AD forest storing shadow accounts      --&gt;
  &lt;param name="nonShadowSuffix" value="shadows.ad.local" /&gt;
  &lt;!-- The attribute thats used for the source of the shadow accounts UPN  --&gt;
  &lt;param name="upnAttributeName" value="mail" /&gt;
  &lt;!-- Attribute to store a flag value if the account is to be a shadow account  --&gt;
  &lt;param name="flagAttributeName" value="description" /&gt;
  &lt;!-- Flag value if the user will become a shadow account       --&gt;
  &lt;param name="flagAttributeValue" value="shadow" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_basicauth_2">BasicAuth</h4>
<div class="paragraph"><p>This filter is used in conjunction with an application with a disabled session. It will perform a basic authentication against the internal virtual directory.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.BasicAuth"&gt;
  &lt;!-- The name of the realm to be presented to the browser      --&gt;
  &lt;param name="realmName" value="Tremolo Basic Realm"/&gt;
  &lt;!-- The name of the attribute to use to lookup the user      --&gt;
  &lt;param name="uidAttr" value="uid"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_anonaz">AnonAz</h4>
<div class="paragraph"><p>This filter is used in conjunction with an application with a disabled session. It will create an AuthInfo object based on an anonymous user.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.AnonAz"&gt;
  &lt;!-- RDN of the anonymous user --&gt;
        &lt;param name="userName" value="uid=Anonymous"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_hidecookie">HideCookie</h4>
<div class="paragraph"><p>This filter will remove all cookies set by the proxied applications prior to being sent to the client. The cookies are stored in an internal cookie jar in the users session. There are no configuration options.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.HideCookie" /&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_lastmilejson">LastMileJSON</h4>
<div class="paragraph"><p>Used inconjunction with the OAuth2 Last Mile Bearer Token authentication scheme, this filter will create an HTML page with an OAuth 2 access token inside of a div called "json".</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.LastMileJSON"&gt;
    &lt;!-- Last Mile encryption key        --&gt;
    &lt;param name="encKeyAlias" value="sessionkey"/&gt;
    &lt;!-- The number of seconds the returned token is valid      --&gt;
    &lt;param name="secondsScew" value="300" /&gt;
    &lt;!-- The number of seconds to adjust for if clocks are not synced   --&gt;
    &lt;param name="secondsToLive" value="100"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_preauthfilter">PreAuthFilter</h4>
<div class="paragraph"><p>Some applications do not work well with a reverse proxy and require an explicit "login" step. In these scenarios the Pre-Authentication filter can be used to create a session prior to the first time a user accesses the website. This filter does a Last Mile login to the url and can optionaly generate a SAML2 assertion and perform an IdP initiated SSO. Once the login is complete the cookies from the request are added to the user&#8217;s cookie jar.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.PreAuthFilter"&gt;
    &lt;!-- Determines if a SAML assertion should be generated and posted to the Pre-Auth URL. If checked an Identity Provider MUST be created to supply the configuration information to generate the assertion.  --&gt;
    &lt;param name="postSAML" value="true"/&gt;
    &lt;!-- The fully qualified domain name (FQDN) and uri of the URL in Unison configured with a LastMile filter configured, only needed if postSAML is true --&gt;
    &lt;param name="url" value="http://mysite.company.com/myapp/login"/&gt;
    &lt;!-- The name of the identity provider that has the configuration information for generating the assertion  --&gt;
    &lt;param name="idpName" value="saml2" /&gt;
    &lt;!-- The host name that should be in the issuer     --&gt;
    &lt;param name="issuerHost" value="localhost.localdomain"/&gt;
    &lt;!-- If the issuer is on a non-standard port, it can be specified here. This field is optional      --&gt;
    &lt;param name="issuerPort" value="6060"/&gt;
    &lt;!-- If the issuer should be https (checked) or http (not checked)  --&gt;
    &lt;param name="issuerSSL" value="false"/&gt;
    &lt;!-- If the application expects a RelayState --&gt;
    &lt;param name="relayState" value="/echo/echo"/&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_groups2attribute">Groups2Attribute</h4>
<div class="paragraph"><p>This filter will create an attribute with the names of groups the user is a member of. An optional regular expression can be used to specify only a certain number of groups.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.PreAuthFilter"&gt;
  &lt;!-- The base in the virtual directory to begin searching for groups.  --&gt;
  &lt;param name="base" value="o=Tremolo" /&gt;
  &lt;!-- Name of the attribute to create  --&gt;
  &lt;param name="attrName" value="roles" /&gt;
  &lt;!-- A regular expression to filter out group memberships     --&gt;
  &lt;param name="pattern" value="groups-(.*)" /&gt;
  &lt;!-- If a pattern is specified, the group from that pattern to add to the attribute   --&gt;
  &lt;param name="groupNum" value="1" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_cookiefilter">CookieFilter</h4>
<div class="paragraph"><p>This filter will stop all cookies, except those configured, from being sent to downstream applications. This can be used to stop third party cookies, attempts to spoof or cookie collisions.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;filter class="com.tremolosecurity.proxy.filters.CookieFilter"&gt;
  &lt;!-- List of cookie names (or regular expressions) to filter  --&gt;
        &lt;param name="ignore" value="cookie2"/&gt;
  &lt;!-- If checked, the values to filter are treated as Java regular expressions. (http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)        --&gt;
  &lt;param name="supportRegex" value="false" /&gt;
&lt;/filter&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_targets_2">Provisioning Targets</h3>
<div class="paragraph"><p>This section details the pre-built provisioning targets that are available for Unison. In addition to these targets, custom targets may be created. Consult the Unison SDK for instructions on how to create a custom target.</p></div>
<div class="paragraph"><p>All targets have a common interface for specifying mappings from Unisons current user object and how attributes will be pushed to the target. Only mapped attributes will be utilized by a provisioning target.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<col style="width:25%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Source Type</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Source</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Example</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">user</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Map an attribute form the users directory object</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Name of an attribute</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">givenName</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">static</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A static value that doesnt change</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The static value</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Myvalue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">custom</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">A class that is used to determine the mapping</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Class name, see the SDK for details on how to implement</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">com.mycompany.mapper.Mapper</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">composite</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Static and attribute data</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Note that if the source attribute is TREMOLO_USER_ID then the user objects id is used. When TREMOLO_USER_ID is the target attribute it sets user objects id.</p></div>
<div class="sect3">
<h4 id="_ldapprovider">LDAPProvider</h4>
<div class="paragraph"><p>This target provisions identities to a generic LDAPv3 directory.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="ldap2"
                                className="com.tremolosecurity.provisioning.core.providers.LDAPProvider"&gt;
        &lt;params&gt;
    &lt;!-- The object class for new user objects --&gt;
                &lt;param name="objectClass" value="inetOrgPerson" /&gt;
    &lt;!-- Host for the ldap server       --&gt;
                &lt;param name="host" value="127.0.0.1" /&gt;
    &lt;!-- The port to connect to --&gt;
                &lt;param name="port" value="10983" /&gt;
    &lt;!-- A DN for a user with administrator rights to create and update accounts        --&gt;
                &lt;param name="adminDN" value="cn=admin,dc=domain,dc=com" /&gt;
    &lt;!-- Credential passwords   --&gt;
                &lt;param name="adminPasswd" value="manager" /&gt;
    &lt;!-- The DN pattern for new users with user attributes in ${}       --&gt;
                &lt;param name="dnPattern" value="uid=${uid},ou=internal,dc=domain,dc=com" /&gt;
    &lt;!-- The base that should be used for searching for users and groups        --&gt;
                &lt;param name="searchBase" value="dc=domain,dc=com" /&gt;
    &lt;!-- The name of the attribute used to identify the user    --&gt;
                &lt;param name="userIDAttribute" value="uid"/&gt;
    &lt;!-- If set to true SSL is used for the connection  --&gt;
                &lt;param name="useSSL" value="false"/&gt;
    &lt;!-- Maximum number of connections to the directory --&gt;
                &lt;param name="maxCons" value="10"/&gt;
    &lt;!-- Maximum number of individual operations per connection --&gt;
                &lt;param name="threadsPerCons" value="10"/&gt;
    &lt;!-- Millisconds an idle connection can stay open --&gt;
    &lt;param name="idleTimeout" value="90000" /&gt;
    &lt;!-- Allow for users from outside the directory to be provisioned into directory groups --&gt;
    &lt;param name="allowExternalUsers" value="false" /&gt;

        &lt;/params&gt;
  &lt;!-- User mappings --&gt;
        &lt;targetAttribute name="uid" sourceType="user"
                source="TREMOLO_USER_ID" /&gt;
        &lt;targetAttribute name="sn" sourceType="user"
                source="sn" /&gt;
        &lt;targetAttribute name="l" sourceType="user"
                source="l" /&gt;
        &lt;targetAttribute name="cn" sourceType="user"
                source="cn" /&gt;
        &lt;targetAttribute name="givenName"
                sourceType="user" source="givenName" /&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_alfrescoproviderrest">AlfrescoProviderREST</h4>
<div class="paragraph"><p>Alfresco is an open source enterprise content management system that uses a RESTful web service for creating and updating users. This target allows the integration of Alfresco into a workflow.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="alfresco"
                                className="com.tremolosecurity.provisioning.core.providers.AlfrescoProviderREST"&gt;
        &lt;params&gt;
    &lt;!-- The full URL of the admin service      --&gt;
                &lt;param name="url" value="https://alfresco.enterprise.com /alfresco/service/api" /&gt;
    &lt;!-- User with admin privileges     --&gt;
    &lt;param name="adminUser" value="Admin" /&gt;
    &lt;!-- Password for admin user        --&gt;
    &lt;param name="adminPwd" value="" /&gt;
    &lt;!-- The user id attribute  --&gt;
    &lt;param name="uidAttributeName" value="uid" /&gt;
    &lt;!-- If set to true, a last mile header will be added to each RESTful request. If false, then the URI of the service api MUST be ignored by the last mile system    --&gt;
    &lt;param name="useLastMile" value="true" /&gt;
    &lt;!-- If useLastMile is true, the key to use to generate the header    --&gt;
    &lt;param name="lastMileKeyAlias" value="lastmilekey" /&gt;
        &lt;/params&gt;
  &lt;!-- User mappings --&gt;
        &lt;targetAttribute name="uid" sourceType="user"
                source="TREMOLO_USER_ID" /&gt;
        &lt;targetAttribute name="sn" sourceType="user"
                source="sn" /&gt;
        &lt;targetAttribute name="l" sourceType="user"
                source="l" /&gt;
        &lt;targetAttribute name="cn" sourceType="user"
                source="cn" /&gt;
        &lt;targetAttribute name="givenName"
                sourceType="user" source="givenName" /&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_adprovider">ADProvider</h4>
<div class="paragraph"><p>This target provisions identities to a Microsoft Active Directory. Note that unlike the Active Directory directory type, the provisioning target does NOT automatically map to an inetOrgPerson object class.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="activedirectory" className="com.tremolosecurity.provisioning.core.providers.ADProvider"&gt;
        &lt;params&gt;
                &lt;!-- Host for the ldap server   --&gt;
                &lt;param name="host" value="ad.tremolo.lan"/&gt;
    &lt;!-- The port to connect to --&gt;
                &lt;param name="port" value="636"/&gt;
    &lt;!-- A DN for a user with administrator rights to create and update accounts        --&gt;
                &lt;param name="adminDN" value="cn=Administrator,cn=Users,dc=enterprise,dc=domain,dc=com"/&gt;
    &lt;!-- Credential passwords   --&gt;
                &lt;param name="adminPasswd" value=""/&gt;
    &lt;!-- The DN pattern for new users with user attributes in ${}       --&gt;
                &lt;param name="dnPattern" value="cn=${cn},cn=Users,dc=enterprise,dc=domain,dc=com"/&gt;
    &lt;!-- The base that should be used for searching for users and groups        --&gt;
                &lt;param name="searchBase" value="dc=enterprise,dc=domain,dc=com"/&gt;
    &lt;!-- The name of the attribute used to identify the user    --&gt;
                &lt;param name="userIDAttribute" value="samAccountName"/&gt;
    &lt;!-- If set to true SSL is used for the connection  --&gt;
                &lt;param name="useSSL" value="true"/&gt;
    &lt;!-- Maximum number of connections to the directory --&gt;
                &lt;param name="maxCons" value="10"/&gt;
    &lt;!-- Maximum number of individual operations per connection --&gt;
                &lt;param name="threadsPerCons" value="10"/&gt;
    &lt;!-- If set to true a shadow account is created. A shadow account is just like a regular account except the password is randomly generated. --&gt;
    &lt;param name="createShadowAccount" value="true"/&gt;
    &lt;!-- Millisconds an idle connection can stay open --&gt;
    &lt;param name="idleTimeout" value="90000" /&gt;
    &lt;!-- Allow for users from outside the directory to be provisioned into directory groups --&gt;
    &lt;param name="allowExternalUsers" value="false" /&gt;


        &lt;/params&gt;
        &lt;targetAttribute name="uid" sourceType="user" source="TREMOLO_USER_ID"  /&gt;
        &lt;targetAttribute name="lastname" sourceType="user" source="sn"  /&gt;
        &lt;targetAttribute name="givenName" sourceType="static" source="staticValue"  /&gt;
        &lt;targetAttribute name="cn" sourceType="custom" source="com.tremolosecurity.test.provisioning.CreateCN"  /&gt;
        &lt;targetAttribute name="login" sourceType="composite" source="${firstname}.${sn}@TEST"  /&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_amazonsimpledbprovider">AmazonSimpleDBProvider</h4>
<div class="paragraph"><p>If utilized as the basis for user data in the cloud this target can be used in a workflow to populate the database.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="jitdb" className="com.tremolosecurity.provisioning.core.providers.AmazonSimpleDBProvider"&gt;
  &lt;params&gt;
      &lt;!-- Domain for storing user information          --&gt;
      &lt;param name="userDomain" value="Users"/&gt;
      &lt;!-- Domain for storing group information --&gt;
      &lt;param name="groupDomain" value="Groups"/&gt;
      &lt;!-- Access Key   --&gt;
      &lt;param name="accessKey" value=""/&gt;
      &lt;!-- Secret Key   --&gt;
      &lt;param name="secretKey" value=""/&gt;
      &lt;!-- The attribute that stores the userid --&gt;
      &lt;param name="uidAttributeName" value="uid"/&gt;
  &lt;/params&gt;
  &lt;!-- Attribute mapping --&gt;
  &lt;targetAttribute name="login" source="uid" sourceType="user"/&gt;
  &lt;targetAttribute name="last" source="sn" sourceType="user"/&gt;
  &lt;targetAttribute name="first" source="givenName" sourceType="user"/&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_basicdb">BasicDB</h4>
<div class="paragraph"><p>This target can be used to create users and update their attributes in a relational database. The target can either use a generic model or a custom model can be updated by implementing a specific interface. For instructions on how to manage a custom database, see the Unison SDK. Note that this target does NOT set password.</p></div>
<div class="paragraph"><div class="title">BasicDB Table Layout with No Groups</div><p><span class="image">
<img src="images/unison-manual-prov-db-nogroup.png" alt="BasicDB Table Layout with No Groups">
</span></p></div>
<div class="paragraph"><div class="title">BasicDB Table Layout with Many-to-Many Groups</div><p><span class="image">
<img src="images/unison-manual-basicdb-groups.png" alt="BasicDB Table Layout with Many-to-Many Groups">
</span></p></div>
<div class="paragraph"><div class="title">BasicDB Table Layout with One-to-Many Groups</div><p><span class="image">
<img src="images/unison-manual-prov-db-groups-one-to-many.png" alt="BasicDB Table Layout with One-to-Many Groups">
</span></p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="jitdb" className="com.tremolosecurity.provisioning.core.providers.BasicDB"&gt;
  &lt;params&gt;
      &lt;!-- The class of the JDBC driver --&gt;
      &lt;param name="driver" value="com.mysql.jdbc.Driver"/&gt;
      &lt;!-- The JDBC URL for accessing the database      --&gt;
      &lt;param name="url" value="jdbc:mysql://endor.tremolo.lan/autogroups"/&gt;
      &lt;!-- An optional character used to escape field names in SQL      --&gt;
      &lt;param name="beginEscape" value="`" /&gt;
      &lt;!-- An optional character used to escape field names in SQL      --&gt;
      &lt;param name="endEscape" value="`" /&gt;
      &lt;!-- The user for connecting to the database      --&gt;
      &lt;param name="user" value="myvd"/&gt;
      &lt;!-- The password for the database        --&gt;
      &lt;param name="password" value=""/&gt;
      &lt;!-- The maximum number of connections to the database    --&gt;
      &lt;param name="maxCons" value="0"/&gt;
      &lt;!-- The maximum time a connection can be idle before its closed in milliseconds  --&gt;
      &lt;param name="maxIdleCons" value="0"/&gt;
      &lt;!-- The name of the table that stores the user objects   --&gt;
      &lt;param name="userTable" value="users"/&gt;
      &lt;!-- The name of the column in the user table that is the primary key     --&gt;
      &lt;param name="userPrimaryKey" value="id"/&gt;
      &lt;param name="userName" value="login"/&gt;
      &lt;!-- Determines how to manage the relationship between users and groups:
          None  No group information is stored
          ManyToMany  Assumes there is a table of users, table of groups and a table that links them
          OneToMany  Assumes theres a table of users with a one-to-many relationship with a groups table
          Custom  Use a custom class to update user attributes and group memberships. See the SDK for implementation details
      --&gt;
      &lt;param name="groupMode" value="ManyToMany"/&gt;
      &lt;!-- The name of the table that stores group information  --&gt;
      &lt;param name="groupTable" value="groups"/&gt;
      &lt;!-- The field start stores the name of the group --&gt;
      &lt;param name="groupName" value="name"/&gt;
      &lt;!-- The name of the column in the link table that maps to the users primary key       --&gt;
      &lt;param name="groupUserKey" value="userid"/&gt;
      &lt;!-- The name of the table used to link users and groups  --&gt;
      &lt;param name="groupLinkTableName" value="usergroups"/&gt;
      &lt;!-- The name of the column in the link table that maps to the groups primary key      --&gt;
      &lt;param name="groupGroupKey" value="groupid"/&gt;
      &lt;!-- The name of the primary key of the group table       --&gt;
      &lt;param name="groupPrimaryKey" value="id"/&gt;
      &lt;!-- If a custom group management is used this option is used to specify how users are looked up. Use %S to specify the fields being looked up, %I for the users numeric ID and %L for the users login      --&gt;
      &lt;param name="userSQL" value=""/&gt;
      &lt;!-- If a custom group management is used this option is used to specify how groups are looked up. Use %S to specify the fields being looked up, %I for the users numeric ID and %L for the users login --&gt;
      &lt;param name="groupSQL" value=""/&gt;
      &lt;!-- The class name for a custom provider. Must implement com.tremolosecurity.provisioning.core.providers.db.CustomDB --&gt;
      &lt;param name="customProvider" value=""/&gt;
      &lt;!-- SQL for validating the connection --&gt;
      &lt;param name="validationQuery" value="SELECT 1"/&gt;
  &lt;/params&gt;
  &lt;!-- Attribute mapping --&gt;
  &lt;targetAttribute name="login" source="uid" sourceType="user"/&gt;
  &lt;targetAttribute name="last" source="sn" sourceType="user"/&gt;
  &lt;targetAttribute name="first" source="givenName" sourceType="user"/&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_tremolotarget">TremoloTarget</h4>
<div class="paragraph"><p>In addition to provisioning to specific targets, Unison can provision to other Unison clusters. This can be used to separate out functions, separating provisioning from access management. Note that all authentication is done via SSL. Before connecting to another Unison instance an SSL certificate must be generated and signed by the valid CA.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="extUnison" className="com.tremolosecurity.provisioning.core.providers.TremoloTarget"&gt;
  &lt;params&gt;
      &lt;!-- The name of the workflow used to create new users    --&gt;
      &lt;param name="createUsersWF" value="createUsers"/&gt;
      &lt;!-- The name of the workflow to delete users     --&gt;
      &lt;param name="deleteUserWF" value="deleteUser"/&gt;
      &lt;!-- The name of the workflow to set a users password  --&gt;
      &lt;param name="setUserPasswordWF" value="setPassword"/&gt;
      &lt;!-- The name of the workflow to synchronize a user       --&gt;
      &lt;param name="syncUserWF" value="syncUser"/&gt;
      &lt;!-- The attribute name for the user identifier   --&gt;
      &lt;param name="uidAttrName" value="uid"/&gt;
      &lt;!-- The url for the unison web service   --&gt;
      &lt;param name="wfUrlBase" value="https://www.tremolosecurity-test.com:9093"/&gt;
  &lt;/params&gt;
  &lt;!-- Attribute mapping --&gt;
  &lt;targetAttribute name="login" source="uid" sourceType="user"/&gt;
  &lt;targetAttribute name="last" source="sn" sourceType="user"/&gt;
  &lt;targetAttribute name="first" source="givenName" sourceType="user"/&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_sugarcrm">SugarCRM</h4>
<div class="paragraph"><p>The SugarCRM target can be used to update contacts inside of SugarCRM. It does not, at present support the creating of users.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="extUnison" className="com.tremolosecurity.provisioning.core.providers.TremoloTarget"&gt;
  &lt;params&gt;
      &lt;!-- The SugarCRM web services URL                --&gt;
      &lt;param name="url" value="http://sugarcrm.domain.com/sugarcrm/service/v2/rest.php"/&gt;
      &lt;!-- Administrative username      --&gt;
      &lt;param name="adminUser" value="admin"/&gt;
      &lt;!-- The users password        --&gt;
      &lt;param name="adminPwd" value=""/&gt;

  &lt;/params&gt;
  &lt;!-- Attribute mapping --&gt;
  &lt;targetAttribute name="login" source="uid" sourceType="user"/&gt;
  &lt;targetAttribute name="last" source="sn" sourceType="user"/&gt;
  &lt;targetAttribute name="first" source="givenName" sourceType="user"/&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_sharepointgroups">SharePointGroups</h4>
<div class="paragraph"><p>This target allows for a user&#8217;s groups in SharePoint to be managed by Unison. For Just-In-Time provisioning it requires that:</p></div>
<div class="ulist"><ul>
<li>
<p>
The LastMile filter is configured on a URL with access to the usergroup.asmx web service
</p>
</li>
<li>
<p>
The internal host name (as it is visible to Unison) is configured as a host on this URL
</p>
</li>
<li>
<p>
That all users managed in sharepoint are already in Active Directory and have logged in once into SharePoint
</p>
</li>
</ul></div>
<div class="paragraph"><p>If not being used for JIT provisioning, or when Last Mile is not yet available NTLM authentication can be used. This requires that identities be already in AD and synced into sharepoint.</p></div>
<div class="paragraph"><div class="title">Multi Site Integration</div><p>If a SharePoint site is made of multiple sites, but NOT subsites off the main site, then Unison must be configured to "know" about these sites. Each Site has its own roles and those roles can only be manipulated by accessing the webservices associated with each individual site.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;target name="extUnison" className="com.tremolosecurity.provisioning.core.providers.TremoloTarget"&gt;
  &lt;params&gt;
      &lt;!-- The URL, from Unison's perspective, of the web services url          --&gt;
      &lt;param name="webServicesURL" value="http://sharepoint-internal.domain.com/_vti_bin/usergroup.asmx"/&gt;
      &lt;!-- Mechanism for authentication to SharePoint. For JIT provisioning you must use Unison Last Mile. (ntlm/lastmile)      --&gt;
      &lt;param name="authMode" value="lastmile"/&gt;
      &lt;!-- Tell Unison if all subsites are a member of the root site or are distinct sites with their own web services endpoints        --&gt;
      &lt;param name="multiSite" value="false"/&gt;
      &lt;!-- List of paths for each site. For instance "/", "/MySite" without quotes      --&gt;
      &lt;param name="siteURI" value="/"/&gt;
      &lt;param name="siteURI" value="/MySite"/&gt;
      &lt;!-- Full user principal name of an administrative user   --&gt;
      &lt;param name="adminUPN" value="admin@domain.com"/&gt;
      &lt;!-- Password for NTLM access     --&gt;
      &lt;param name="adminPassword" value=""/&gt;
      &lt;!-- Lastmile Key Alias --&gt;
      &lt;param name="keyAlias" value=""/&gt;
      &lt;!-- Last mile header name --&gt;
      &lt;param name="headerName" value=""/&gt;
      &lt;!-- Variance in milliseconds between the Unison clock and sharepoint clock --&gt;
      &lt;param name="skew" value=""/&gt;

  &lt;/params&gt;
  &lt;!-- Attribute mapping --&gt;
  &lt;targetAttribute name="login" source="uid" sourceType="user"/&gt;
  &lt;targetAttribute name="last" source="sn" sourceType="user"/&gt;
  &lt;targetAttribute name="first" source="givenName" sourceType="user"/&gt;
&lt;/target&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_provisioning_custom_tasks">Provisioning Custom Tasks</h3>
<div class="paragraph"><p>This section details the pre-built provisioning custom tasks. These tasks can be used in your deployments without change. Consult the Unison SDK for instructions on how to create a custom task.</p></div>
<div class="paragraph"><p>All tasks have a common interface for specifying configuration options. Each task can take any number of name/value pairs. A single configuration option can have multiple values by listing the name/value pair for each value.</p></div>
<div class="sect3">
<h4 id="_filtergroups">FilterGroups</h4>
<div class="paragraph"><p>This task can be used to limit the groups that are available to a target. For instance if a user could have the groups "Admin","Developer" and "User" but the target only has the groups "Admin" and "User" this task can be used to filter out "Developer". This way no "rogue" groups are presented to a target. This task should be used inside of a mapping task to make sure that other tasks are not effected.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.FilterGroups"&gt;
  &lt;!-- A group name that should pass through this filter, case sensitive and can be listed multiple times       --&gt;
  &lt;param name="name" value="User"/&gt;
  &lt;param name="name" value="Admins"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_loadattributes">LoadAttributes</h4>
<div class="paragraph"><p>This task will load attributes from a user&#8217;s entry in the virtual directory. It&#8217;s useful when a workflow is only being called with a user identifier or a subset of attributes and additional attributes are needed for reporting or decision making.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.LoadAttributes"&gt;
  &lt;!-- An attribute name to load, case sensitive and can be listed multiple times       --&gt;
  &lt;param name="name" value="givenName"/&gt;
  &lt;param name="name" value="sn"/&gt;
  &lt;!-- The name of the attribute that identifies the user in the virtual directory      --&gt;
  &lt;param name="nameAttr" value="uid"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_mapgroups">MapGroups</h4>
<div class="paragraph"><p>The Map User Groups task will map group names from a "global" name to a target specific name. For instance if there is a generic group called "Administrator" but the target stores administrators in the group "SYS_ADMINS" this task can be used to create that mapping. It should be deployed inside of a mapping to make sure that global groups are not effected.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.MapGroups"&gt;
  &lt;!-- A mapping of target from source. To map Admins --&gt; SYS_ADMIN the value should be SYS_ADMIN=Admins. This attribute can be mapped multiple times.          --&gt;
  &lt;param name="map" value="SYS_ADMIN=Admins"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_setpassword">SetPassword</h4>
<div class="paragraph"><p>This task is useful in user registration scenarios where a user&#8217;s password must be set but the email address needs to be verified. It triggers a password reset through the password reset authenticaiton mechanism. In order for this task to work, it MUST have a password reset authentication mechanism configured where the workflow is configured.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.SetPassword"&gt;
  &lt;!-- The name of the password reset mechanism as defined in the Auth Mechs section.   --&gt;
  &lt;param name="mechName" value="PasswordReset"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_attribute2group">Attribute2Group</h4>
<div class="paragraph"><p>This task takes the values of an attribute and adds them to a user&#8217;s groups. This is useful when building generic workflows.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.Attribute2Group"&gt;
  &lt;!-- The name of the attribute to get the group values from. Once the values are added, the attribute is removed from the user.               --&gt;
  &lt;param name="attributeName" value="roles"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_jitignoregroups">JITIgnoreGroups</h4>
<div class="paragraph"><p>This task will allow for a group to be ignored during a just-in-time provisioning process. If the user is a member of the named group in named target the user&#8217;s provisioning object is also given the group. This way when the synchronization occurs the group is ignored.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.JITIgnoreGroups"&gt;
  &lt;!-- The name of the group to ignore          --&gt;
  &lt;param name="groupName" value="Administrators"/&gt;
  &lt;!-- The name of the provisioning target to search    --&gt;
  &lt;param name="targetName" value="adUsers"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_loadgroups">LoadGroups</h4>
<div class="paragraph"><p>The Load Groups task will load all the groups a user is a member of in Unison&#8217;s virtual directory. It can also optionally load the "inverse", only groups the user is NOT going to be a member of after this task. This can be useful when deleting a user from a group.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.LoadGroups"&gt;
  &lt;!-- The attribute name to search for on the user's account   --&gt;
  &lt;param name="nameAttr" value="uid"/&gt;
  &lt;!-- If set to true, only loads the groups from the virtual directory that the user's object is NOT already a member of               --&gt;
  &lt;param name="inverse" value="false"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_jitbasicdbcreategroups">JITBasicDBCreateGroups</h4>
<div class="paragraph"><p>The Just-In-Time Create Groups task can create groups in a database table if they aren&#8217;t present. This is useful when using a database to store group information in a cloud situation where the list of groups is unknown at deployment time. It is used in conjunction with a database provisioning target that has a group table defined.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.JITBasicDBCreateGroups"&gt;
  &lt;!-- The name of a database provisioning taget                --&gt;
  &lt;param name="targetName" value="jitDB"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_printuserinfo">PrintUserInfo</h4>
<div class="paragraph"><p>The Print User Info task is useful when developing and debuging workflows. It will pring the user&#8217;s attributes to the Unison log file.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.PrintUserInfo"&gt;
  &lt;!-- An optional label to add to the log message      --&gt;
  &lt;param name="message" value="After Approval"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_createotpkey">CreateOTPKey</h4>
<div class="paragraph"><p>Creates an OATH key, used with the Time Based One Time Password authentication mechanism.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;customTask className="com.tremolosecurity.provisioning.customTasks.CreateOTPKey"&gt;
  &lt;!-- The name of the attribute to store the token in          --&gt;
  &lt;param name="attributeName" value="l"/&gt;
  &lt;!-- The host name of the service, used for identification in the authenticator       --&gt;
  &lt;param name="hostName" value="www.someplace.com"/&gt;
  &lt;!-- The name of the key used to encrypt and decrypt the user's token. Can be obtained from the TOTP Authentication Mechanism on your Authentication Chain.   --&gt;
  &lt;param name="encryptionKey" value="lastmile-enc-totp"/&gt;
&lt;/customTask&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_message_listeners">Message Listeners</h3>
<div class="paragraph"><p>This section details the pre-built message listeners. These tasks can be used in your deployments without change. Consult the Unison SDK for instructions on how to create message listeners.</p></div>
<div class="paragraph"><p>All listeners have a common interface for specifying configuration options. Each task can take any number of name/value pairs. A single configuration option can have multiple values by listing the name/value pair for each value.</p></div>
<div class="sect3">
<h4 id="_updateapprovalazlistener">UpdateApprovalAZListener</h4>
<div class="paragraph"><p>This listener is used in conjunction with the Update Authorizations scheduled task. The scheduled task identifies open approvals and places those approvals on the queue. This listener picks those approvals up and re-sets the allowed approvers.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- queueName - The name of the queue to listen to --&gt;
&lt;listener className="com.tremolosecurity.provisioning.listeners.UpdateApprovalAZListener" queueName="rebaseQueue"&gt;&lt;/listener&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_autofailapprovallistener">AutoFailApprovalListener</h4>
<div class="paragraph"><p>This listener is used in conjunction with the Automatically Fail Open Approvals scheduled task. The scheduled task identifies which open approvals are assigned to the failure user and adds those approvals to the queue. This listener executes the failure of those requests.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;!-- queueName - The name of the queue to listen to --&gt;
&lt;listener className="com.tremolosecurity.provisioning.listeners.AutoFailApprovalListener" queueName="failQueue"&gt;&lt;/listener&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_scheduled_jobs">Scheduled Jobs</h3>
<div class="paragraph"><p>This section details the pre-built Unison jobs. These jobs can be used in your deployments without change. Consult the Unison SDK for instructions on how to create custom jobs.</p></div>
<div class="paragraph"><p>All jobs have a common interface for specifying configuration options. Each job can take any number of name/value pairs. A single configuration option can have multiple values by listing the name/value pair for each value.</p></div>
<div class="sect3">
<h4 id="_updateapprovalaz">UpdateApprovalAz</h4>
<div class="paragraph"><p>This job evaluates all open approvals and resets the allowed approvers based on the configured authorizations in the workflow. This allows for any changes to members of groups or that a filter would apply to to be reflected in the list of open approvers. This job is used in conjunction with the Update Approvals Authorizations message listener. The job finds all open approvals and adds each approval to the queue. The Update Approvals Authorizations message listener then updates the allowed approvers for each open approval.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;job className="com.tremolosecurity.provisioning.scheduler.jobs.UpdateApprovalAz" name="resetAllowedApprovers" group="testing"&gt;
  &lt;!-- When to run the job --&gt;
        &lt;cronSchedule
                seconds="0"
                minutes="0"
                hours="*"
                dayOfMonth="*"
                month="*"
                dayOfWeek="?"
                year="*"
        /&gt;
  &lt;!-- The name of the queue the Update Approvals Authorizations message listener is configured on      --&gt;
        &lt;param name="queueName" value="rebaseQueue" /&gt;
&lt;/job&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_remindapprovers">RemindApprovers</h4>
<div class="paragraph"><p>This job provides a mechanism for reminding users that they have open approvals waiting for their action.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;job className="com.tremolosecurity.provisioning.scheduler.jobs.RemindApprovers" name="remindAppovers" group="testing"&gt;
  &lt;!-- When to run the job --&gt;
        &lt;cronSchedule
                seconds="0"
                minutes="0"
                hours="9"
                dayOfMonth="*"
                month="*"
                dayOfWeek="?"
                year="*"
        /&gt;
  &lt;!--
  The SQL used on the audit database to determine which approvers to send reminders to. This SQL must:
    1.  Have a single parameter that represents the number of days a request for approval is open
    2.  Returns:
      a. daysOpen - number of days the request has been open
      b. label - the label of the workflow being processed
      c. mail - The email address of the user to be reminded
  --&gt;
        &lt;param name="sql" value="select * from (SELECT datediff(DAY,approvals.createTS,GETDATE()) as daysOpen ,approvals.label,mail FROM approvals INNER JOIN allowedApprovers on approvals.id=allowedApprovers.approval INNER JOIN approvers on approvers.id=allowedApprovers.approver WHERE approvals.approvedTS IS NULL ) X where daysOpen &gt;= ?" /&gt;
  &lt;!-- The template for the message to send to the approvers. Use %L to represent the label of the workflow that is open and %D to represent the number of days open    --&gt;
  &lt;param name="message" value="The request %L has been open for %D days, please login to act on this request" /&gt;
  &lt;!-- The number of days an approval request should be open before sending a reminder  --&gt;
  &lt;param name="days" value="7" /&gt;
&lt;/job&gt;</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_autofail">AutoFail</h4>
<div class="paragraph"><p>This job identifies all open approvals assigned to a specific user and marks them to be declined. The job takes these approval requests and puts them on a queue to be picked up by the Automatically Fail Open Approvals listener.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;job className="com.tremolosecurity.provisioning.scheduler.jobs.AutoFail" name="autoFail" group="autoFail"&gt;
        &lt;cronSchedule
                seconds="0"
                minutes="0"
                hours="*"
                dayOfMonth="*"
                month="*"
                dayOfWeek="?"
                year="*"
        /&gt;
  &lt;!-- The name of the queue to add approval requests to        --&gt;
        &lt;param name="queueName" value="failQueue" /&gt;
  &lt;!-- A message to be provided to users as to why the request failed   --&gt;
        &lt;param name="approver" value="autoFail" /&gt;
  &lt;!-- The name of the user whom all failures are assigned, must be the value of the user identifier attribute configured on the audit database --&gt;
        &lt;param name="message" value="failed : ${reason}" /&gt;
&lt;/job&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_authorization_rules">Custom Authorization rules</h3>
<div class="paragraph"><p>This section details the pre-built Unison custom authorization rules. These rules can be used in your deployments without change. Consult the Unison SDK for instructions on how to create custom custom authorization rules.</p></div>
<div class="paragraph"><p>All custom authorization rules have a common interface for specifying configuration options. Each rule can take any number of name/value pairs. A single configuration option can have multiple values by listing the name/value pair for each value.</p></div>
<div class="sect3">
<h4 id="_managerauthorization">ManagerAuthorization</h4>
<div class="paragraph"><p>This rule provides a mechanism for allowing a user&#8217;s supervisor or manager to approve a request. The approver is authorized based on the user&#8217;s data in Unison&#8217;s internal virtual directory.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;azRule name="managerLevel1" className="com.tremolosecurity.provisioning.az.ManagerAuthorization"&gt;
  &lt;!-- Use this to define what "distance" of a manager is authorized. For instance to allow the user's manager's manager to perform the authorization specify "2". This allows for escalations to be processed with multiple tiers of managers. --&gt;
        &lt;params name="numLevels" value="1" /&gt;
  &lt;!-- The name of the attribute on the user's directory object that will tell Unison who their manager is.     --&gt;
        &lt;params name="managerID" value="manager" /&gt;
  &lt;!-- If checked, Unison will assume that the attribute defined in "Manager Attribute Name" is the distinguished name of the user's manager. If not checked, then Unison will use a filter built from the "User Identifier Attribute" from the Approvals screen and the value of the "Manager Attribute Name"  --&gt;
        &lt;params name="managerIDIsDN" value="true" /&gt;
  &lt;!-- Used when the number of levels is greater then one, allowing all the managers between the user and the current step to approve. For instance of an approval is escalated to a user's manager's manager checking this option will allow both the user's manager AND the user's manager's manager to approve.      --&gt;
        &lt;params name="allowLowerManagers" value="false" /&gt;
&lt;/azRule&gt;</pre>
</div></div>
</div>
</div>
<div class="sect2">
<h3 id="_identity_providers_2">Identity Providers</h3>
<div class="paragraph"><p>Unison supports multiple identity provider implementations. Each identity provider has its own configuration. This section details how to configure an individual type of identity provider. Each identity provider type has a global configuration, which is on the URL screen, and a trust configuration which tells Unison how to provide information for a particular partner.</p></div>
<div class="sect3">
<h4 id="_saml2idp">Saml2Idp</h4>
<div class="paragraph"><p>SAML2 is a standard form of federation that is very popular in enterprise environments. Unison can act as a SAML2 identity provider providing SAML2 assertions, attributes and strong security. The SAML2 identity provider supports signing and encrypting of assertions.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&lt;application isApp="false" name="saml2"&gt;
        &lt;results /&gt;
        &lt;urls&gt;

                &lt;url regex="false"&gt;
      &lt;!-- Set the hosts for the IdP --&gt;
                        &lt;host&gt;localhost.localdomain&lt;/host&gt;
      &lt;!-- List filters, these filters should focus on manipulating the authenticated user's account --&gt;
                        &lt;filterChain&gt;
                                &lt;filter class="com.tremolosecurity.test.util.AddGroupFilter" /&gt;
                                &lt;filter class="com.tremolosecurity.prelude.filters.Group2Attribute"&gt;
                                        &lt;param name="attributeName" value="role" /&gt;
                                        &lt;param name="attributeValue" value="users" /&gt;
                                        &lt;param name="groupDN" value="cn=linkedSAMLUsers,ou=internal,ou=GenericLDAP,o=Tremolo" /&gt;
                                &lt;/filter&gt;
                        &lt;/filterChain&gt;
      &lt;!-- URI for the IDP should ALLWAYS be this value --&gt;
                        &lt;uri&gt;/auth/idp/saml2&lt;/uri&gt;
                        &lt;results&gt;
                                &lt;auSuccess&gt;&lt;/auSuccess&gt;
                                &lt;auFail&gt;failure&lt;/auFail&gt;
                                &lt;azSuccess&gt;&lt;/azSuccess&gt;
                                &lt;azFail&gt;failure&lt;/azFail&gt;
                        &lt;/results&gt;
      &lt;!-- Authorize who has access to this IdP --&gt;
                        &lt;azRules&gt;
                                &lt;rule constraint="(objectClass=*)" scope="filter" /&gt;
                        &lt;/azRules&gt;
      &lt;!-- IdP Specific Configuration --&gt;
                        &lt;idp className="com.tremolosecurity.idp.providers.Saml2Idp"&gt;
        &lt;!-- The key used for encrypting authentication requests. The key should be listed under the Signature and Encryption Keys in Certs       --&gt;
                                &lt;params value="" name="encKey" /&gt;
        &lt;!-- The key used for verifying signed authentication requests. The key should be listed under the Signature and Encryption Keys in Certs --&gt;
                                &lt;params value="idp-sig-key" name="sigKey" /&gt;
        &lt;!-- Must the identity provider require signed metadata? If not checked, signed metadata will still be accepted and validated.  --&gt;
        &lt;param name="requireSignedAuthn" value="true" /&gt;
        &lt;!-- Mappings for attributes to be included in the assertion --&gt;
        &lt;mappings strict="true"&gt;
                                        &lt;mapping sourceType="user" targetAttributeSource="groupName"
                                                targetAttributeName="groupName" /&gt;
                                        &lt;mapping sourceType="static" targetAttributeSource="Boston"
                                                targetAttributeName="l" /&gt;
                                        &lt;mapping sourceType="user" targetAttributeSource="role" targetAttributeName="role" /&gt;
                                &lt;/mappings&gt;
        &lt;!-- Trusts establish connections with remote service providers --&gt;
                                &lt;trusts&gt;
          &lt;!--
            A trust establishes a connection between the SAML2 IdP and a SAML2 SP. The trust configuration establishes this connection by specifying URLs, certificates and mappings from nameid and authentication types to attributes and authentication chains respectively. The name of the trust must match with the issuer in a saml response or assertion. The only profile supported by Unison is the HTTP-POST profile.
           --&gt;
                                        &lt;trust name="http://shib2x.tremolo.lan/shibboleth"&gt;
            &lt;!-- The URL used to post the response to. This is optional if included in the authentication request.      (AssertionConsumerService) --&gt;
                                                &lt;param
                                                        value="http://shib2x.tremolo.lan/Shibboleth.sso/SAML2/POST"
                                                        name="httpPostRespURL" /&gt;

            &lt;!-- The key used to sign the response or assertion --&gt;
            &lt;param value="" name="spSigKey" /&gt;
            &lt;!-- The key used to encrypt assertions     --&gt;
                                                &lt;param value="" name="spEncKey" /&gt;
            &lt;!-- Determine if the assertion should be signed. If encrypting assertions, its expected that the assertion will be signed. --&gt;
                                                &lt;param value="false" name="signAssertion" /&gt;
            &lt;!-- Should the entire response (including the assertion)   --&gt;
                                                &lt;param value="true" name="signResponse" /&gt;
            &lt;!-- If no nameid format is specified in the authentication request or in the idp initiated request this setting specifies which attribute to use to identify the user      --&gt;
                                                &lt;param value="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
                                                        name="defaultNameId" /&gt;
            &lt;!-- If no authentication class context reference is specified in the authentication request or in the idp initiated request specifies how to authenticate the user --&gt;
            &lt;param
                                                        value="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport"
                                                        name="defaultAuthCtx" /&gt;
            &lt;!-- map a requested nameid format to an attribute to look the user up by.  may be lsited multiple times, but must be listed AT LEAST once.  The default name id MUST be included --&gt;
            &lt;param value="urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified=uid"
                                                        name="nameIdMap" /&gt;
            &lt;!-- map a requests authentication context class ref to an authentication chain.  may be listed multiple times but must be listed AT LEAST once.  The default authnContextClassRef must be included --&gt;
            &lt;param
                                                        value="urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport=form"
                                                        name="authCtxMap" /&gt;
                                        &lt;/trust&gt;
                                &lt;/trusts&gt;
                        &lt;/idp&gt;
                &lt;/url&gt;
        &lt;/urls&gt;
        &lt;cookieConfig&gt;
                &lt;sessionCookieName&gt;tremoloSession&lt;/sessionCookieName&gt;
                &lt;domain&gt;localhost.localdomain&lt;/domain&gt;
                &lt;scope&gt;-1&lt;/scope&gt;
                &lt;logoutURI&gt;/logout&lt;/logoutURI&gt;
                &lt;keyAlias&gt;session-tremolosession&lt;/keyAlias&gt;
                &lt;keyPassword&gt;&lt;/keyPassword&gt;
        &lt;/cookieConfig&gt;
&lt;/application&gt;</pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_command_line_reference">Command Line Reference</h2>
<div class="sectionbody">
<div class="paragraph"><p>To make it easier to configure OpenUnison a command line tool has been provided to make the job of performing certain tasks easier.  This tool is a single executable jar that can be downloaded from <a href="https://www.tremolosecurity.com/nexus/service/local/repositories/releases/content/com/tremolosecurity/unison/openunison-util/1.0.6/openunison-util-1.0.6-jar-with-dependencies.jar">https://www.tremolosecurity.com/nexus/service/local/repositories/releases/content/com/tremolosecurity/unison/openunison-util/1.0.6/openunison-util-1.0.6-jar-with-dependencies.jar</a>.</p></div>
<div class="sect2">
<h3 id="_export_aes_256_keys">Export AES-256 Keys</h3>
<div class="paragraph"><p>The java keytool command doesn&#8217;t provide any capability to export the AES-256 keys that OpenUnison uses.  In order to export the keys (such as when using TOTP) use the opeunison-util system:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$ java -jar openunison-util-1.0.6-jar-with-dependencies.jar -action print-secretkey  -unisonXMLFile openunison/src/main/webapp/WEB-INF/unison.xml -keystorePath openunison/src/main/webapp/WEB-INF/unisonKeyStore.jks -alias session-unison</pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_importing_saml2_metadata">Importing SAML2 Metadata</h3>
</div>
<div class="sect2">
<h3 id="_generating_saml2_metadata">Generating SAML2 Metadata</h3>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 1.0.6<br>
Last updated 2015-12-13 08:37:46 EST
</div>
</div>
</body>
</html>
